<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ğ¡ĞĞ¡Ğ¢Ğ Ğ« Ğ¡ĞœĞ•Ğ¥Ğ</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700;900&family=Share+Tech+Mono&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg0: #07030d;
  --bg1: #0e0818;
  --bg2: #160d22;
  --glass: rgba(255,180,255,0.03);
  --glass2: rgba(255,180,255,0.06);
  --border: rgba(255,180,255,0.09);
  --border2: rgba(255,180,255,0.16);
  --c1: #ff3d9a;   /* neon pink â€” ÑĞ¼ĞµÑ…, Ñ€Ğ°Ğ´Ğ¾ÑÑ‚ÑŒ */
  --c2: #ffd700;   /* gold â€” Ñ‚ĞµĞ°Ñ‚Ñ€, ÑĞ²ĞµÑ‚ */
  --c3: #9b3dff;   /* violet â€” Ğ¼Ğ°Ğ³Ğ¸Ñ, Ğ¾Ñ€Ğ´ĞµĞ½ */
  --c4: #ff8c42;   /* amber â€” Ğ¾Ğ³Ğ¾Ğ½ÑŒ, Ñ‚ĞµĞ¿Ğ»Ğ¾ */
  --c5: #00d4ff;   /* cyan â€” Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ»Ñ‹ */
  --text: #cbb8d8;
  --dim: #5a4570;
  --white: #fff5ff;
}

*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}

html,body{
  height:100%; background:var(--bg0);
  color:var(--text); font-family:'Exo 2',sans-serif;
  overflow:hidden; -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
}

/* â”€â”€ BACKGROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#bg{position:fixed;inset:0;z-index:0;overflow:hidden;}
#bg::before{
  content:'';position:absolute;inset:0;
  background:
    radial-gradient(ellipse 80% 60% at 15% 20%, rgba(155,61,255,.16) 0%, transparent 60%),
    radial-gradient(ellipse 60% 50% at 85% 70%, rgba(255,61,154,.09) 0%, transparent 55%),
    radial-gradient(ellipse 50% 40% at 50% 100%, rgba(255,140,66,.07) 0%, transparent 50%);
}
#canvas{position:absolute;inset:0;width:100%;height:100%;}

/* â”€â”€ SHELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.shell{
  position:relative;z-index:1;
  display:flex;flex-direction:column;
  height:100%;max-width:480px;margin:0 auto;
}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hdr{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 14px 8px;
  background:rgba(7,3,13,.75);
  backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(255,61,154,.22);
  box-shadow:0 2px 24px rgba(0,0,0,.6);
  flex-shrink:0;
}
.hdr-left{display:flex;align-items:center;gap:10px;}
.avatar{
  width:34px;height:34px;border-radius:50%;
  background:linear-gradient(135deg,var(--c3),var(--c1));
  display:flex;align-items:center;justify-content:center;
  font-size:15px;font-weight:700;color:#fff;
  flex-shrink:0;overflow:hidden;
  box-shadow:0 0 16px rgba(155,61,255,.7),0 0 32px rgba(155,61,255,.3);
}
.avatar img{width:100%;height:100%;object-fit:cover;}
.uname{font-size:13px;font-weight:700;color:var(--white);max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.utitle{font-size:9px;color:var(--c1);letter-spacing:2px;margin-top:1px;text-shadow:0 0 8px rgba(255,61,154,.6);}

.hdr-stats{display:flex;gap:14px;}
.hs{text-align:center;}
.hs-l{font-size:8px;letter-spacing:1.5px;color:var(--dim);text-transform:uppercase;}
.hs-v{font-family:'Share Tech Mono',monospace;font-size:13px;color:var(--c1);text-shadow:0 0 8px rgba(255,61,154,.7);}
.hs-v.amber{color:var(--c2);text-shadow:0 0 8px rgba(255,215,0,.7);}

/* â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tabs{
  display:flex;background:rgba(7,3,13,.65);
  border-bottom:1px solid var(--border);flex-shrink:0;
}
.tab{
  flex:1;padding:9px 4px;text-align:center;
  font-size:11px;letter-spacing:1px;font-weight:600;
  color:var(--dim);cursor:pointer;
  border-bottom:2px solid transparent;
  transition:all .2s;text-transform:uppercase;
}
.tab.active{
  color:var(--c1);border-color:var(--c1);
  text-shadow:0 0 8px rgba(255,61,154,.8);
  background:rgba(255,61,154,.04);
}

/* â”€â”€ CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.content{flex:1;overflow-y:auto;overflow-x:hidden;position:relative;}
.page{display:none;flex-direction:column;}
.page.active{display:flex;}

::-webkit-scrollbar{width:2px;}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:1px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLICKER PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pg-click{
  align-items:center;padding:14px 16px 20px;gap:14px;
  min-height:100%;
}

/* SCORE */
.score-wrap{text-align:center;position:relative;}
.score-num{
  font-family:'Share Tech Mono',monospace;
  font-size:clamp(32px,8vw,48px);font-weight:700;
  color:var(--white);line-height:1;letter-spacing:4px;
  text-shadow:
    0 0 4px #ff3d9a,
    0 0 20px rgba(255,61,154,.9),
    0 0 50px rgba(255,61,154,.5),
    0 0 100px rgba(255,61,154,.2);
}
.score-unit{font-size:10px;letter-spacing:4px;color:var(--dim);text-transform:uppercase;margin-top:4px;}
.score-cps{font-size:13px;color:var(--c1);margin-top:3px;font-family:'Share Tech Mono',monospace;letter-spacing:2px;}

/* COMBO */
.combo-wrap{
  display:flex;align-items:center;gap:6px;
  background:var(--glass);border:1px solid var(--border);
  border-radius:8px;padding:5px 14px;
  transition:all .2s;
}
.combo-wrap.active{
  background:rgba(255,215,0,.08);
  border-color:rgba(255,215,0,.4);
  box-shadow:0 0 20px rgba(255,215,0,.15),inset 0 0 10px rgba(255,215,0,.04);
}
.combo-label{font-size:9px;letter-spacing:2px;color:var(--dim);text-transform:uppercase;}
.combo-val{font-family:'Share Tech Mono',monospace;font-size:16px;font-weight:700;color:var(--c2);text-shadow:0 0 10px rgba(255,215,0,.8);}
.combo-bar-wrap{flex:1;height:4px;background:rgba(255,255,255,.04);border-radius:2px;overflow:hidden;}
.combo-bar{height:100%;background:linear-gradient(90deg,var(--c2),var(--c1));border-radius:2px;transition:width .1s linear;}

/* BUTTON */
.btn-arena{
  position:relative;width:200px;height:200px;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
}
.orbit{position:absolute;border-radius:50%;animation:orb linear infinite;}
.o1{inset:0;border:1px solid rgba(255,61,154,.4);animation-duration:10s;}
.o2{inset:14px;border:1px dashed rgba(155,61,255,.45);animation-duration:16s;animation-direction:reverse;}
.o3{inset:28px;border:1px solid rgba(255,215,0,.3);animation-duration:8s;}
.o4{inset:42px;border:1px dotted rgba(255,140,66,.35);animation-duration:20s;animation-direction:reverse;}
@keyframes orb{to{transform:rotate(360deg);}}

.glow-ring{
  position:absolute;inset:30px;border-radius:50%;
  animation:glowPulse 2s ease-in-out infinite;
}
@keyframes glowPulse{
  0%,100%{box-shadow:0 0 0 0 rgba(255,61,154,.5),0 0 20px rgba(255,61,154,.2);}
  50%{box-shadow:0 0 0 22px rgba(255,61,154,.0),0 0 40px rgba(255,61,154,.15);}
}

.click-btn{
  position:relative;z-index:5;
  width:130px;height:130px;border-radius:50%;
  border:none;cursor:pointer;
  background:
    radial-gradient(circle at 35% 30%,rgba(255,255,255,.18),transparent 55%),
    radial-gradient(circle at 65% 70%,rgba(255,61,154,.07),transparent 50%),
    radial-gradient(circle,#180d24 0%,#07030d 100%);
  box-shadow:
    0 0 0 2px rgba(255,61,154,.5),
    0 0 30px rgba(255,61,154,.3),
    0 0 70px rgba(155,61,255,.25),
    0 0 120px rgba(255,61,154,.1),
    inset 0 0 40px rgba(255,61,154,.08);
  font-size:44px;
  transition:transform .07s,box-shadow .07s;
  display:flex;align-items:center;justify-content:center;
  -webkit-tap-highlight-color:transparent;
  overflow:hidden;
}
.click-btn::after{
  content:'';position:absolute;inset:0;border-radius:50%;
  background:radial-gradient(circle,rgba(255,61,154,.18) 0%,transparent 70%);
  opacity:0;transition:opacity .1s;
}
.click-btn:active{
  transform:scale(.88);
  box-shadow:
    0 0 0 3px var(--c1),
    0 0 50px rgba(255,61,154,.8),
    0 0 100px rgba(255,61,154,.4),
    0 0 160px rgba(155,61,255,.3),
    inset 0 0 60px rgba(255,61,154,.22);
}
.click-btn:active::after{opacity:1;}

/* BOOSTS row */
.boosts-row{display:flex;gap:8px;width:100%;}
.boost-chip{
  flex:1;background:var(--glass);border:1px solid rgba(255,255,255,.1);
  border-radius:8px;padding:8px;text-align:center;cursor:pointer;
  transition:all .15s;position:relative;overflow:hidden;
}
.boost-chip:active{transform:scale(.96);}
.boost-chip.active-boost{
  border-color:rgba(255,61,154,.6);
  background:rgba(255,61,154,.1);
  box-shadow:0 0 20px rgba(255,61,154,.2),inset 0 0 8px rgba(255,61,154,.05);
}
.boost-chip-icon{font-size:20px;}
.boost-chip-name{font-size:9px;color:var(--dim);letter-spacing:1px;margin-top:2px;}
.boost-chip-val{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--c1);margin-top:1px;}
.boost-chip-cd{
  position:absolute;bottom:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,var(--c1),var(--c3));
  transform-origin:left;transition:transform .1s linear;
}

/* STATS GRID */
.stats-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;width:100%;}
.stat-card{
  background:var(--glass);border:1px solid rgba(255,255,255,.12);
  border-radius:10px;padding:10px 8px;text-align:center;
  position:relative;transition:border-color .2s,box-shadow .2s;
}
.stat-card:hover{border-color:rgba(255,61,154,.3);box-shadow:0 0 12px rgba(255,61,154,.08);}
.stat-card::before,.stat-card::after{
  content:'';position:absolute;width:7px;height:7px;
  border-color:var(--c1);border-style:solid;opacity:.6;
}
.stat-card::before{top:0;left:0;border-width:1px 0 0 1px;}
.stat-card::after{bottom:0;right:0;border-width:0 1px 1px 0;}
.stat-card-l{font-size:8px;letter-spacing:1.5px;color:var(--dim);text-transform:uppercase;}
.stat-card-v{font-family:'Share Tech Mono',monospace;font-size:15px;color:var(--white);margin-top:3px;text-shadow:0 0 8px rgba(255,255,255,.3);}

/* PRESTIGE BAR */
.pbar-section{width:100%;}
.pbar-head{
  display:flex;justify-content:space-between;
  font-size:9px;letter-spacing:2px;color:var(--dim);
  text-transform:uppercase;margin-bottom:5px;
}
.pbar-track{
  height:6px;background:rgba(155,61,255,.06);border-radius:3px;
  overflow:hidden;border:1px solid rgba(155,61,255,.3);
}
.pbar-fill{
  height:100%;border-radius:3px;
  background:linear-gradient(90deg,var(--c3),var(--c1),var(--c2));
  transition:width .4s ease;
  box-shadow:0 0 12px rgba(255,61,154,.7),0 0 24px rgba(155,61,255,.4);
  position:relative;overflow:hidden;
}
.pbar-fill::after{
  content:'';position:absolute;inset:0;
  background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,.3) 50%,transparent 100%);
  animation:shimmer 2s linear infinite;
}
@keyframes shimmer{from{transform:translateX(-100%)}to{transform:translateX(100%)}}

.prestige-btn{
  width:100%;padding:13px;
  background:linear-gradient(135deg,rgba(255,61,154,.1),rgba(155,61,255,.12));
  border:1px solid rgba(255,61,154,.6);
  border-radius:12px;color:var(--c1);
  font-family:'Exo 2',sans-serif;font-weight:700;
  font-size:13px;letter-spacing:4px;
  cursor:pointer;transition:all .2s;text-transform:uppercase;
  text-shadow:0 0 10px rgba(255,61,154,.8);
  box-shadow:0 0 25px rgba(255,61,154,.1),inset 0 0 20px rgba(255,61,154,.04);
}
.prestige-btn:active{
  background:linear-gradient(135deg,rgba(255,61,154,.2),rgba(155,61,255,.22));
  box-shadow:0 0 50px rgba(255,61,154,.3),inset 0 0 30px rgba(255,61,154,.1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOP PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pg-shop{padding:10px 12px 20px;gap:8px;overflow-y:auto;}

.sec-title{
  font-size:9px;letter-spacing:4px;color:var(--c1);
  text-transform:uppercase;padding:10px 0 7px;
  border-bottom:1px solid rgba(255,61,154,.18);
  flex-shrink:0;display:flex;align-items:center;gap:6px;
  text-shadow:0 0 8px rgba(255,61,154,.5);
}
.sec-title::before{
  content:'';width:3px;height:10px;
  background:var(--c1);border-radius:2px;
  box-shadow:0 0 6px var(--c1);
}

/* Stars grid */
.stars-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.star-card{
  background:var(--glass);
  border:1px solid rgba(255,215,0,.25);
  border-radius:12px;padding:12px;
  cursor:pointer;transition:all .18s;
  position:relative;overflow:hidden;
}
.star-card::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(255,215,0,.06),transparent);
  opacity:0;transition:opacity .2s;
}
.star-card:hover{
  border-color:rgba(255,215,0,.55);
  box-shadow:0 0 20px rgba(255,215,0,.12);
  transform:translateY(-1px);
}
.star-card:active{transform:scale(.96);}
.star-card:active::before{opacity:1;}
.sc-icon{font-size:26px;margin-bottom:5px;}
.sc-name{font-size:12px;font-weight:700;color:var(--white);}
.sc-desc{font-size:10px;color:var(--dim);margin:3px 0 7px;line-height:1.4;}
.sc-price{
  font-family:'Share Tech Mono',monospace;font-size:11px;
  color:var(--c2);display:flex;align-items:center;gap:3px;
}
.sc-badge{
  position:absolute;top:8px;right:8px;
  background:rgba(255,61,154,.15);border:1px solid rgba(255,61,154,.3);
  border-radius:4px;padding:1px 5px;font-size:8px;color:var(--c1);letter-spacing:1px;
}

/* Gen cards */
.gen-card{
  background:var(--glass);border:1px solid rgba(255,255,255,.1);
  border-radius:10px;padding:11px 12px;
  cursor:pointer;transition:all .15s;
  display:flex;align-items:center;gap:10px;
}
.gen-card:not(.gc-locked):hover{
  border-color:rgba(255,61,154,.4);
  background:rgba(255,61,154,.05);
  box-shadow:0 0 12px rgba(255,61,154,.1);
}
.gen-card:active:not(.gc-locked){
  background:rgba(255,61,154,.08);
  border-color:rgba(255,61,154,.4);
}
.gc-locked{opacity:.3;pointer-events:none;}
.gc-icon{font-size:26px;flex-shrink:0;}
.gc-body{flex:1;min-width:0;}
.gc-name{font-size:13px;font-weight:700;color:var(--white);}
.gc-sub{font-size:10px;color:var(--dim);margin-top:1px;}
.gc-cost{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--c2);margin-top:3px;}
.gc-owned{
  font-family:'Share Tech Mono',monospace;
  font-size:24px;font-weight:700;
  color:var(--c1);min-width:32px;text-align:right;
  text-shadow:0 0 8px rgba(255,61,154,.6);
}
.gc-cps{font-size:9px;color:var(--c3);text-align:right;margin-top:1px;}

/* Upgrade cards */
.upg-card{
  background:var(--glass);border:1px solid rgba(255,255,255,.1);
  border-radius:10px;padding:10px 12px;
  cursor:pointer;transition:all .15s;
  display:flex;align-items:center;gap:10px;
}
.upg-card:not(.uc-locked):not(.uc-maxed):hover{
  border-color:rgba(255,61,154,.35);
  box-shadow:0 0 12px rgba(255,61,154,.08);
}
.upg-card:active:not(.uc-locked):not(.uc-maxed){
  background:rgba(255,61,154,.05);
  border-color:rgba(255,61,154,.3);
}
.uc-locked{opacity:.3;pointer-events:none;}
.uc-maxed{border-color:rgba(255,215,0,.25)!important;pointer-events:none;background:rgba(255,215,0,.03);}
.uc-icon{font-size:22px;flex-shrink:0;}
.uc-body{flex:1;}
.uc-name{font-size:12px;font-weight:700;color:var(--white);}
.uc-desc{font-size:10px;color:var(--dim);margin-top:1px;}
.uc-right{text-align:right;flex-shrink:0;}
.uc-cost{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--c2);}
.uc-status{font-size:9px;color:var(--dim);margin-top:2px;letter-spacing:1px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FRIENDS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pg-friends{padding:14px;gap:10px;overflow-y:auto;}

.ref-hero{
  background:linear-gradient(135deg,rgba(255,61,154,.07),rgba(155,61,255,.07));
  border:1px solid rgba(255,61,154,.22);
  box-shadow:0 0 30px rgba(255,61,154,.06),inset 0 0 20px rgba(255,61,154,.03);
  border-radius:14px;padding:18px;text-align:center;
}
.ref-icon{font-size:36px;margin-bottom:8px;}
.ref-title{
  font-family:'Cinzel',serif;font-size:16px;
  color:var(--c1);margin-bottom:6px;letter-spacing:3px;
  text-shadow:0 0 12px rgba(255,61,154,.8);
}
.ref-desc{font-size:12px;color:var(--dim);line-height:1.6;margin-bottom:10px;}
.ref-bonus{
  background:rgba(255,61,154,.07);border:1px solid rgba(255,61,154,.2);
  border-radius:8px;padding:8px;
  font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--c1);
  margin-bottom:12px;
}
.ref-btn{
  width:100%;padding:12px;
  background:linear-gradient(135deg,rgba(255,61,154,.12),rgba(155,61,255,.12));
  border:1px solid rgba(255,61,154,.35);
  border-radius:10px;color:var(--c1);
  font-family:'Exo 2',sans-serif;font-weight:700;
  font-size:12px;letter-spacing:2px;text-transform:uppercase;
  cursor:pointer;transition:all .2s;
  text-shadow:0 0 8px rgba(255,61,154,.6);
  box-shadow:0 0 15px rgba(255,61,154,.1);
}
.ref-btn:active{transform:scale(.97);}

.friends-head{
  font-family:'Share Tech Mono',monospace;
  font-size:11px;color:var(--dim);text-align:center;
}
.friends-head span{color:var(--c1);}

.friend-row{
  background:var(--glass);border:1px solid var(--border);
  border-radius:10px;padding:10px 14px;
  display:flex;align-items:center;gap:10px;
}
.fr-av{
  width:38px;height:38px;border-radius:50%;
  background:linear-gradient(135deg,var(--c3),var(--c1));
  display:flex;align-items:center;justify-content:center;
  font-size:17px;font-weight:700;color:#fff;flex-shrink:0;
}
.fr-info{flex:1;}
.fr-name{font-size:13px;font-weight:700;color:var(--white);}
.fr-score{font-size:10px;color:var(--dim);}
.fr-earn{font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--c1);}

/* â”€â”€ PARTICLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ptc{
  position:fixed;pointer-events:none;z-index:999;
  font-family:'Share Tech Mono',monospace;font-size:16px;font-weight:900;
  animation:ptcUp .85s ease-out forwards;
}
@keyframes ptcUp{
  0%{opacity:1;transform:translateY(0) scale(1);}
  100%{opacity:0;transform:translateY(-80px) scale(.4);}
}
.ptc-crit{font-size:24px!important;animation-duration:1.1s!important;text-shadow:0 0 15px currentColor!important;}

/* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast{
  position:fixed;top:68px;left:50%;transform:translateX(-50%);
  background:rgba(14,8,24,.96);
  border:1px solid rgba(255,61,154,.5);border-radius:10px;
  padding:9px 18px;
  font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--c1);
  letter-spacing:1.5px;z-index:1000;pointer-events:none;
  box-shadow:0 0 30px rgba(255,61,154,.15),0 0 60px rgba(255,61,154,.05);
  text-shadow:0 0 8px rgba(255,61,154,.7);
  animation:tIn .3s ease,tOut .3s ease 2.7s forwards;
  white-space:nowrap;max-width:92vw;text-align:center;
  backdrop-filter:blur(16px);
}
@keyframes tIn{from{opacity:0;top:52px;}to{opacity:1;top:68px;}}
@keyframes tOut{to{opacity:0;top:52px;}}

/* â”€â”€ LEVEL UP FLASH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.levelup{
  position:fixed;inset:0;z-index:998;pointer-events:none;
  background:radial-gradient(circle,rgba(255,61,154,.22) 0%,rgba(155,61,255,.1) 40%,transparent 70%);
  animation:lvlFlash .7s ease-out forwards;
}
@keyframes lvlFlash{0%{opacity:1;}40%{opacity:.8;}100%{opacity:0;}}

/* â”€â”€ ACTIVE BOOST TIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.active-timer{
  font-family:'Share Tech Mono',monospace;
  font-size:9px;color:var(--c1);letter-spacing:1px;text-align:center;
  animation:blink 1s ease-in-out infinite;
}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:.4;}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SISTERS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pg-sisters{padding:12px 12px 24px;gap:10px;overflow-y:auto;}

/* Sister card */
.sister-card{
  background:var(--glass);border:1px solid var(--border);
  border-radius:14px;padding:14px;
  display:flex;gap:12px;align-items:flex-start;
  transition:all .2s;position:relative;overflow:hidden;
}
.sister-card.s-unlocked{
  border-color:rgba(255,61,154,.25);
}
.sister-card.s-unlocked:hover{
  border-color:rgba(255,61,154,.5);
  box-shadow:0 0 20px rgba(255,61,154,.1);
}
.sister-card.s-locked{opacity:.45;}
.sister-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--c1),transparent);
  opacity:0;transition:opacity .3s;
}
.sister-card.s-unlocked:hover::before{opacity:.6;}

/* Portrait */
.s-portrait{
  width:90px;height:120px;border-radius:12px;flex-shrink:0;
  background:linear-gradient(135deg,var(--bg2),var(--bg1));
  border:1px solid var(--border2);
  display:flex;align-items:center;justify-content:center;
  font-size:42px;overflow:hidden;position:relative;
  cursor:pointer;transition:all .2s;
}
.s-portrait:hover{border-color:var(--c1);box-shadow:0 0 16px rgba(255,61,154,.3);}
.s-portrait img{width:100%;height:100%;object-fit:cover;object-position:top;border-radius:11px;}
.s-portrait-lock{
  position:absolute;inset:0;background:rgba(7,3,13,.7);
  display:flex;align-items:center;justify-content:center;font-size:22px;
  border-radius:11px;
}
/* Zoom hint Ğ´Ğ»Ñ Ğ¿Ğ¾Ñ€Ñ‚Ñ€ĞµÑ‚Ğ¾Ğ² Ñ Ğ°Ñ€Ñ‚Ğ¾Ğ¼ */
.s-portrait.has-art::after{
  content:'â¤¢';position:absolute;bottom:4px;right:5px;
  font-size:11px;color:rgba(255,255,255,.5);line-height:1;
  pointer-events:none;
}

/* â”€â”€ ART MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#artModal{
  display:none;position:fixed;inset:0;z-index:9999;
  background:rgba(7,3,13,.92);
  align-items:center;justify-content:center;
  flex-direction:column;gap:12px;
  backdrop-filter:blur(8px);
  -webkit-backdrop-filter:blur(8px);
}
#artModal.open{display:flex;}
#artModal img{
  max-width:90vw;max-height:80vh;
  border-radius:16px;
  border:1px solid rgba(255,61,154,.3);
  box-shadow:0 0 60px rgba(155,61,255,.3);
  object-fit:contain;
}
#artModal .art-name{
  font-family:'Cinzel',serif;font-size:18px;color:var(--white);
  letter-spacing:2px;text-align:center;
}
#artModal .art-close{
  position:absolute;top:16px;right:20px;
  font-size:28px;color:var(--dim);cursor:pointer;line-height:1;
}

/* Sister info */
.s-info{flex:1;min-width:0;}
.s-name{
  font-family:'Cinzel',serif;font-size:14px;font-weight:700;
  color:var(--white);letter-spacing:1px;
}
.s-title{font-size:9px;color:var(--c1);letter-spacing:2px;margin-top:1px;text-transform:uppercase;}
.s-desc{font-size:10px;color:var(--dim);margin-top:5px;line-height:1.5;}

/* XP bar */
.s-xp-row{display:flex;align-items:center;gap:6px;margin-top:8px;}
.s-xp-label{font-size:9px;color:var(--dim);letter-spacing:1px;white-space:nowrap;}
.s-xp-track{
  flex:1;height:5px;background:rgba(255,255,255,.05);
  border-radius:3px;overflow:hidden;border:1px solid var(--border);
}
.s-xp-fill{
  height:100%;border-radius:3px;
  background:linear-gradient(90deg,var(--c3),var(--c1));
  transition:width .4s ease;
  box-shadow:0 0 6px rgba(255,61,154,.5);
}
.s-level-badge{
  background:rgba(255,61,154,.15);border:1px solid rgba(255,61,154,.3);
  border-radius:6px;padding:2px 7px;
  font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--c1);
  white-space:nowrap;
}

/* Sister bonuses */
.s-bonuses{display:flex;gap:5px;margin-top:7px;flex-wrap:wrap;}
.s-bonus-chip{
  background:rgba(155,61,255,.1);border:1px solid rgba(155,61,255,.25);
  border-radius:5px;padding:2px 7px;
  font-size:9px;color:var(--c3);letter-spacing:.5px;
}
.s-bonus-chip.active{
  background:rgba(255,61,154,.12);border-color:rgba(255,61,154,.35);
  color:var(--c1);
}

/* Skin strip */
.s-skins{
  display:flex;gap:6px;margin-top:8px;overflow-x:auto;
  padding-bottom:2px;
}
.s-skin-thumb{
  width:44px;height:44px;border-radius:8px;flex-shrink:0;
  background:var(--bg2);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  font-size:20px;cursor:pointer;transition:all .18s;position:relative;
}
.s-skin-thumb.active{
  border-color:var(--c1);
  box-shadow:0 0 12px rgba(255,61,154,.4);
}
.s-skin-thumb.skin-locked{opacity:.35;cursor:default;}
.s-skin-lock{
  position:absolute;bottom:1px;right:1px;
  font-size:9px;line-height:1;
}
.s-skin-name{
  font-size:7px;color:var(--dim);text-align:center;
  margin-top:2px;letter-spacing:.5px;max-width:44px;
  overflow:hidden;white-space:nowrap;text-overflow:ellipsis;
}

/* Unlock hint */
.s-unlock-hint{
  font-size:10px;color:var(--dim);
  margin-top:5px;font-style:italic;
}

/* Section label in sisters */
.sisters-section-title{
  font-size:9px;letter-spacing:3px;color:var(--dim);
  text-transform:uppercase;padding:8px 0 5px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:6px;
}
.sisters-section-title::before{
  content:'';width:2px;height:8px;
  background:var(--c3);border-radius:2px;
}

/* â”€â”€ CRT SCANLINES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::after{
  content:'';position:fixed;inset:0;
  background:repeating-linear-gradient(
    0deg,transparent,transparent 2px,
    rgba(0,0,0,0.05) 2px,rgba(0,0,0,0.05) 4px
  );
  pointer-events:none;z-index:9000;
}
</style>
</head>
<body>
<div id="bg"><canvas id="canvas"></canvas></div>

<div class="shell">
  <!-- HEADER -->
  <div class="hdr">
    <div class="hdr-left">
      <div class="avatar" id="avatar">?</div>
      <div>
        <div class="uname" id="uname">Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒ</div>
        <div class="utitle" id="utitle">Ğ¡ĞĞ§Ğ£Ğ’Ğ¡Ğ¢Ğ’Ğ£Ğ®Ğ©Ğ˜Ğ™</div>
      </div>
    </div>
    <div class="hdr-stats">
      <div class="hs"><div class="hs-l">Ğ¡Ğ¼ĞµÑ…</div><div class="hs-v" id="hTotal">0</div></div>
      <div class="hs"><div class="hs-l">Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ</div><div class="hs-v amber" id="hLevel">1</div></div>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <div class="tab active" data-tab="click">ğŸ­ ĞÑ…Ğ¾Ñ‚Ğ°</div>
    <div class="tab" data-tab="sisters">ğŸ‘ï¸ Ğ¡Ñ‘ÑÑ‚Ñ€Ñ‹</div>
    <div class="tab" data-tab="shop">ğŸª Ğ›Ğ°Ğ²ĞºĞ°</div>
    <div class="tab" data-tab="friends">ğŸŒ¹ Ğ¡Ğ¾ÑĞ·Ğ½Ğ¸ĞºĞ¸</div>
  </div>

  <div class="content">

    <!-- â•â• CLICKER PAGE â•â• -->
    <div class="page active pg-click" id="page-click">

      <div class="score-wrap">
        <div class="score-num" id="scoreNum">0</div>
        <div class="score-unit">ÑĞ¼ĞµÑ…</div>
        <div class="score-cps" id="scoreCps">+0/Ñ</div>
      </div>

      <!-- COMBO -->
      <div class="combo-wrap" id="comboWrap">
        <div class="combo-label">Ğ¦Ğ•ĞŸĞĞ§ĞšĞ</div>
        <div class="combo-val" id="comboVal">Ã—1.0</div>
        <div class="combo-bar-wrap"><div class="combo-bar" id="comboBar" style="width:100%"></div></div>
      </div>

      <!-- BUTTON -->
      <div class="btn-arena">
        <div class="orbit o1"></div>
        <div class="orbit o2"></div>
        <div class="orbit o3"></div>
        <div class="orbit o4"></div>
        <div class="glow-ring"></div>
        <button class="click-btn" id="mainBtn">ğŸ­</button>
      </div>

      <!-- ACTIVE BOOSTS -->
      <div class="boosts-row">
        <div class="boost-chip" id="bFrenzy">
          <div class="boost-chip-icon">ğŸ”¥</div>
          <div class="boost-chip-name">Ğ¯Ğ ĞĞ¡Ğ¢Ğ¬</div>
          <div class="boost-chip-val" id="bFrenzyVal">Ã—3</div>
          <div class="boost-chip-cd" id="bFrenzyCd" style="transform:scaleX(0)"></div>
        </div>
        <div class="boost-chip" id="bLucky">
          <div class="boost-chip-icon">ğŸ€</div>
          <div class="boost-chip-name">Ğ£Ğ”ĞĞ§Ğ</div>
          <div class="boost-chip-val" id="bLuckyVal">ĞšĞ Ğ˜Ğ¢</div>
          <div class="boost-chip-cd" id="bLuckyCd" style="transform:scaleX(0)"></div>
        </div>
        <div class="boost-chip" id="bRush">
          <div class="boost-chip-icon">âš¡</div>
          <div class="boost-chip-name">ĞĞĞ¢Ğ˜Ğ¡Ğš</div>
          <div class="boost-chip-val" id="bRushVal">+CPS</div>
          <div class="boost-chip-cd" id="bRushCd" style="transform:scaleX(0)"></div>
        </div>
      </div>

      <!-- STATS -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-card-l">Ğ£Ğ´Ğ°Ñ€</div>
          <div class="stat-card-v" id="scClick">1</div>
        </div>
        <div class="stat-card">
          <div class="stat-card-l">Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸</div>
          <div class="stat-card-v" id="scGens">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-card-l">Ğ’Ğ¾ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ</div>
          <div class="stat-card-v" id="scPrestige">Ã—1</div>
        </div>
      </div>

      <!-- PRESTIGE -->
      <div class="pbar-section">
        <div class="pbar-head">
          <span>Ğ”Ğ¾ Ğ²Ğ¾ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ</span><span id="pbarPct">0%</span>
        </div>
        <div class="pbar-track">
          <div class="pbar-fill" id="pbarFill" style="width:0%"></div>
        </div>
      </div>

      <button class="prestige-btn" id="prestigeBtn" style="display:none">
        âœ¨ Ğ’ĞĞ¡Ğ¥ĞĞ–Ğ”Ğ•ĞĞ˜Ğ• â€” ĞĞĞ’Ğ«Ğ™ Ğ¦Ğ˜ĞšĞ› âœ¨
      </button>

    </div>

    <!-- â•â• SISTERS PAGE â•â• -->
    <div class="page pg-sisters" id="page-sisters">
      <div class="sisters-section-title">ĞÑ€Ğ´ĞµĞ½ Â«Ğ¡ĞµÑÑ‚Ñ‘Ñ€ Ğ¡Ğ¼ĞµÑ…Ğ°Â»</div>
      <div id="sistersList"></div>
    </div>

    <!-- â•â• SHOP PAGE â•â• -->
    <div class="page pg-shop" id="page-shop">

      <div class="sec-title">â­ Ğ”Ğ°Ñ€Ñ‹ ĞÑ€Ğ´ĞµĞ½Ğ° (Telegram Stars)</div>
      <div class="stars-grid" id="starsGrid"></div>

      <div class="sec-title">ğŸª Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ¡Ğ¼ĞµÑ…Ğ°</div>
      <div id="genList"></div>

      <div class="sec-title">âœ¨ Ğ Ğ¸Ñ‚ÑƒĞ°Ğ»Ñ‹ Ğ¸ Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ</div>
      <div id="upgList"></div>

    </div>

    <!-- â•â• FRIENDS PAGE â•â• -->
    <div class="page pg-friends" id="page-friends">
      <div class="ref-hero">
        <div class="ref-icon">ğŸŒ¹</div>
        <div class="ref-title">ĞŸĞ Ğ˜Ğ—ĞĞ’Ğ˜ Ğ¡ĞĞ®Ğ—ĞĞ˜ĞšĞ</div>
        <div class="ref-desc">ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ¾ÑĞ·Ğ½Ğ¸Ğº ÑƒÑĞ¸Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ ĞÑ€Ğ´ĞµĞ½. Ğ’Ğ¼ĞµÑÑ‚Ğµ Ğ¼Ñ‹ Ğ¿Ğ¾Ğ±ĞµĞ´Ğ¸Ğ¼ Ğ¢ĞµĞ½Ğ¸ ĞÑ‚Ñ‡Ğ°ÑĞ½Ğ¸Ñ Ğ¸ Ğ²ĞµÑ€Ğ½Ñ‘Ğ¼ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ ĞºÑ€Ğ°ÑĞºĞ¸!</div>
        <div class="ref-bonus">ğŸŒ¹ +10% Ğº Ğ¡Ğ¼ĞµÑ…Ñƒ Ğ·Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞ¾ÑĞ·Ğ½Ğ¸ĞºĞ°</div>
        <button class="ref-btn" id="shareBtn">ğŸ“œ ĞŸĞĞ—Ğ’ĞĞ¢Ğ¬ Ğ¡ĞĞ®Ğ—ĞĞ˜ĞšĞ</button>
      </div>
      <div class="friends-head">Ğ¡Ğ¾ÑĞ·Ğ½Ğ¸ĞºĞ¾Ğ²: <span id="friendCount">0</span></div>
      <div id="friendList"></div>
    </div>

  </div>
</div>

<script>
'use strict';

/* â•â• TELEGRAM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const tg = window.Telegram?.WebApp;
let TGU = null;
if(tg){
  tg.expand();
  try{tg.requestFullscreen?.();}catch(e){}
  tg.disableVerticalSwipes?.();
  tg.enableClosingConfirmation?.();
  TGU = tg.initDataUnsafe?.user||null;
}

/* â•â• CANVAS â€” RAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(()=>{
  const cv=document.getElementById('canvas');
  const cx=cv.getContext('2d');
  let W,H,drops=[];

  const resize=()=>{
    W=cv.width=innerWidth;
    H=cv.height=innerHeight;
    initDrops();
  };

  function initDrops(){
    drops=[];
    const count=Math.floor(W/3.5);
    for(let i=0;i<count;i++){
      const neon=Math.random()>.93;
      drops.push({
        x:Math.random()*W,
        y:Math.random()*H,
        len:Math.random()*18+6,
        speed:Math.random()*3.5+1.8,
        a:Math.random()*.12+.02,
        neon,
        hue:neon?(Math.random()>.5?330:45):null
      });
    }
  }

  resize();
  window.addEventListener('resize',resize);

  let puddleTime=0;
  const puddles=[];

  function addPuddle(){
    puddles.push({x:Math.random()*W,y:H-Math.random()*30-10,r:1,maxR:Math.random()*15+5,a:.4});
  }

  const draw=(t)=>{
    cx.clearRect(0,0,W,H);

    // Rain drops
    drops.forEach(d=>{
      cx.beginPath();
      cx.moveTo(d.x,d.y);
      cx.lineTo(d.x-d.len*.12,d.y+d.len);
      if(d.neon){
        cx.strokeStyle=`hsla(${d.hue},100%,70%,${d.a*4})`;
        cx.lineWidth=1.2;
      }else{
        cx.strokeStyle=`rgba(180,150,210,${d.a})`;
        cx.lineWidth=.5;
      }
      cx.stroke();
      d.y+=d.speed;
      if(d.y-d.len>H){
        d.y=-d.len;
        d.x=Math.random()*W;
        if(Math.random()>.7)addPuddle();
      }
    });

    // Puddle ripples
    for(let i=puddles.length-1;i>=0;i--){
      const p=puddles[i];
      cx.beginPath();
      cx.ellipse(p.x,p.y,p.r,p.r*.3,0,0,Math.PI*2);
      cx.strokeStyle=`rgba(200,150,220,${p.a})`;
      cx.lineWidth=.5;
      cx.stroke();
      p.r+=.5;p.a-=.025;
      if(p.a<=0)puddles.splice(i,1);
    }

    requestAnimationFrame(draw);
  };
  requestAnimationFrame(draw);
})();

/* â•â• GAME DATA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// 25 Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ² Ğ¡Ğ¼ĞµÑ…Ğ°
const GENS=[
  {id:'phonograph',   icon:'ğŸµ', name:'Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹ ĞŸĞ°Ñ‚ĞµÑ„Ğ¾Ğ½',         baseCost:15,        baseCps:.1,    desc:'ĞœĞµĞ»Ğ¾Ğ´Ğ¸Ñ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ³Ğ¾'},
  {id:'lantern',      icon:'ğŸ•¯ï¸',name:'Ğ¡Ğ²ĞµÑ‡Ğ½Ğ¾Ğ¹ Ğ¤Ğ¾Ğ½Ğ°Ñ€ÑŒ',          baseCost:100,       baseCps:.5,    desc:'Ğ¡Ğ»Ğ°Ğ±Ñ‹Ğ¹ ÑĞ²ĞµÑ‚ Ğ²Ğ¾ Ñ‚ÑŒĞ¼Ğµ'},
  {id:'mirror',       icon:'ğŸª', name:'Ğ“Ñ€Ğ¸Ğ¼Ñ‘Ñ€Ğ½Ğ¾Ğµ Ğ—ĞµÑ€ĞºĞ°Ğ»Ğ¾',       baseCost:500,       baseCps:2,     desc:'ĞÑ‚Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸ÑÑ‚Ğ¸Ğ½Ñ‹'},
  {id:'booth',        icon:'ğŸŸï¸',name:'Ğ¢ĞµĞ°Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ğ°Ñ ĞšĞ°ÑÑĞ°',        baseCost:2000,      baseCps:8,     desc:'Ğ’Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ±Ğ¸Ğ»ĞµÑ‚Ñ‹'},
  {id:'carousel',     icon:'ğŸ ', name:'ĞšĞ°Ñ€ÑƒÑĞµĞ»ÑŒ',                baseCost:8000,      baseCps:25,    desc:'Ğ’ĞµÑ‡Ğ½Ğ¾Ğµ Ğ²ĞµÑĞµĞ»ÑŒĞµ'},
  {id:'jazz',         icon:'ğŸ·', name:'Ğ”Ğ¶Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞšĞ²Ğ°Ñ€Ñ‚ĞµÑ‚',        baseCost:30000,     baseCps:80,    desc:'Ğ¡Ğ¸Ğ½ĞºĞ¾Ğ¿Ğ° Ğ½Ğ°Ğ´ĞµĞ¶Ğ´Ñ‹'},
  {id:'piano',        icon:'ğŸ¹', name:'ĞœĞµÑ…Ğ°Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ĞŸĞ¸Ğ°Ğ½Ğ¸Ğ½Ğ¾',    baseCost:100000,    baseCps:250,   desc:'ĞŸÑ€Ğ¸Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ğ¼ÑƒĞ·Ñ‹ĞºĞ°Ğ½Ñ‚'},
  {id:'clown',        icon:'ğŸª', name:'Ğ£Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞšĞ»Ğ¾ÑƒĞ½',           baseCost:300000,    baseCps:700,   desc:'Ğ¡Ğ¼ĞµÑ… Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ…'},
  {id:'library',      icon:'ğŸ“š', name:'Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ ĞµĞºĞ²Ğ¸Ğ·Ğ¸Ñ‚Ğ°',    baseCost:900000,    baseCps:2000,  desc:'ĞÑ€Ñ…Ğ¸Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ ĞÑ€Ğ´ĞµĞ½Ğ°'},
  {id:'mirrorball',   icon:'ğŸª©', name:'Ğ—ĞµÑ€ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¨Ğ°Ñ€',          baseCost:3e6,       baseCps:6000,  desc:'ĞÑ‚Ğ±Ğ»ĞµÑĞºĞ¸ Ñ€Ğ°Ğ´Ğ¾ÑÑ‚Ğ¸'},
  {id:'casket',       icon:'ğŸ’', name:'ĞĞµÑ„Ñ€Ğ¸Ñ‚Ğ¾Ğ²Ğ°Ñ Ğ¨ĞºĞ°Ñ‚ÑƒĞ»ĞºĞ°',     baseCost:1e7,       baseCps:18000, desc:'Ğ”Ñ€ĞµĞ²Ğ½Ğ¸Ğµ Ğ¿Ğ¸Ğ³Ğ¼ĞµĞ½Ñ‚Ñ‹'},
  {id:'troupe',       icon:'ğŸ­', name:'Ğ¢Ñ€ÑƒĞ¿Ğ¿Ğ° ĞĞºÑ‚Ñ‘Ñ€Ğ¾Ğ²',          baseCost:3e7,       baseCps:50000, desc:'Ğ–Ğ¸Ğ²Ñ‹Ğµ Ğ»ĞµĞ³ĞµĞ½Ğ´Ñ‹'},
  {id:'varietee',     icon:'ğŸŒ™', name:'ĞĞ¾Ñ‡Ğ½Ğ¾Ğµ Ğ’Ğ°Ñ€ÑŒĞµÑ‚Ğµ',          baseCost:1e8,       baseCps:160000,desc:'Ğ¢Ğ°Ğ¹Ğ½Ñ‹Ğ¹ ÑĞ¿ĞµĞºÑ‚Ğ°ĞºĞ»ÑŒ'},
  {id:'underground',  icon:'ğŸšª', name:'ĞŸĞ¾Ğ´Ğ¿Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¢ĞµĞ°Ñ‚Ñ€',        baseCost:4e8,       baseCps:5e5,   desc:'Ğ—Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½Ğ½Ğ¾Ğµ ÑˆĞ¾Ñƒ'},
  {id:'alchemy',      icon:'âš—ï¸', name:'ĞĞ»Ñ…Ğ¸Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ›Ğ°Ğ±Ğ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¸Ñ',baseCost:2e9,       baseCps:1.8e6, desc:'Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ Ğ¡Ğ¼ĞµÑ…Ğ°'},
  {id:'archive',      icon:'ğŸ“œ', name:'ĞÑ€Ñ…Ğ¸Ğ² ĞÑ€Ğ´ĞµĞ½Ğ°',            baseCost:8e9,       baseCps:6e6,   desc:'Ğ¢Ğ°Ğ¹Ğ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ'},
  {id:'circus',       icon:'ğŸ¡', name:'Ğ¦Ğ¸Ñ€ĞºĞ¾Ğ²Ğ¾Ğ¹ ĞšÑƒĞ¿Ğ¾Ğ»',          baseCost:4e10,      baseCps:2e7,   desc:'ĞšÑƒĞ¿Ğ¾Ğ» Ğ¼Ğ¸Ñ€Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ'},
  {id:'altar',        icon:'ğŸª”', name:'ĞĞµÑ„Ñ€Ğ¸Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ ĞĞ»Ñ‚Ğ°Ñ€ÑŒ',       baseCost:2e11,      baseCps:7e7,   desc:'Ğ Ğ¸Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ³Ğ¾Ğ½ÑŒ'},
  {id:'tower',        icon:'ğŸ—¼', name:'Ğ‘Ğ°ÑˆĞ½Ñ ĞŸĞ°Ğ¼ÑÑ‚Ğ¸',            baseCost:1e12,      baseCps:2.5e8, desc:'Ğ­Ñ…Ğ¾ Ğ¿Ñ€Ğ¾ÑˆĞ»Ñ‹Ñ… ÑĞ¼ĞµÑ…Ğ¾Ğ²'},
  {id:'heart',        icon:'â¤ï¸â€ğŸ”¥',name:'Ğ¡ĞµÑ€Ğ´Ñ†Ğµ ĞÑ€Ğ´ĞµĞ½Ğ°',          baseCost:5e12,      baseCps:9e8,   desc:'ĞŸÑƒĞ»ÑŒÑ Ğ¡ĞµÑÑ‚Ñ‘Ñ€'},
  {id:'truthmirror',  icon:'ğŸ”®', name:'Ğ—ĞµÑ€ĞºĞ°Ğ»Ğ¾ Ğ˜ÑÑ‚Ğ¸Ğ½Ñ‹',          baseCost:3e13,      baseCps:3e9,   desc:'ĞÑ‚Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ğ¢ÑŒĞ¼Ñƒ'},
  {id:'gates',        icon:'ğŸŒ€', name:'Ğ’Ñ€Ğ°Ñ‚Ğ° Ğ¡Ğ¼ĞµÑ…Ğ°',             baseCost:2e14,      baseCps:1e10,  desc:'ĞŸĞ¾Ñ€Ñ‚Ğ°Ğ» Ñ€Ğ°Ğ´Ğ¾ÑÑ‚Ğ¸'},
  {id:'chronicles',   icon:'ğŸ“–', name:'Ğ¥Ñ€Ğ¾Ğ½Ğ¸ĞºĞ¸ Ğ¡ĞµÑÑ‚Ñ‘Ñ€',          baseCost:1e15,      baseCps:4e10,  desc:'Ğ’ĞµÑ‡Ğ½Ğ°Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ'},
  {id:'nexus',        icon:'âœ¨', name:'ĞĞµĞºÑÑƒÑ Ğ Ğ°Ğ´Ğ¾ÑÑ‚Ğ¸',          baseCost:8e15,      baseCps:2e11,  desc:'Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ²ÑĞµĞ³Ğ¾'},
  {id:'grandtheatre', icon:'ğŸŒŸ', name:'Ğ’ĞµĞ»Ğ¸ĞºĞ¸Ğ¹ Ğ¢ĞµĞ°Ñ‚Ñ€ ĞœĞ¸Ñ€Ğ°',      baseCost:1e17,      baseCps:1e12,  desc:'Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°ĞºÑ‚'},
];

// 35 Ğ Ğ¸Ñ‚ÑƒĞ°Ğ»Ğ¾Ğ² Ğ¸ Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğ¹
const UPGRADES=[
  // Ğ£Ğ´Ğ°Ñ€ (ĞºĞ»Ğ¸Ğº) â€” 5 ÑˆÑ‚ÑƒĞº
  {id:'u1', icon:'ğŸ¨',name:'ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ“Ñ€Ğ¸Ğ¼',           desc:'Ğ£Ğ´Ğ°Ñ€ Ã—2',            cost:100,    req:0,       type:'click', val:2},
  {id:'u2', icon:'ğŸ’„',name:'ĞĞ»Ğ°Ñ ĞŸĞ¾Ğ¼Ğ°Ğ´Ğ°',            desc:'Ğ£Ğ´Ğ°Ñ€ Ã—3',            cost:600,    req:150,     type:'click', val:3},
  {id:'u3', icon:'ğŸ­',name:'ĞœĞ°ÑĞºĞ° Ğ¡Ğ¼ĞµÑ…Ğ°',            desc:'Ğ£Ğ´Ğ°Ñ€ Ã—5',            cost:8000,   req:2000,    type:'click', val:5},
  {id:'u4', icon:'ğŸ’«',name:'Ğ Ğ¸Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ“Ñ€Ğ¸Ğ¼',        desc:'Ğ£Ğ´Ğ°Ñ€ Ã—10',           cost:200000, req:50000,   type:'click', val:10},
  {id:'u5', icon:'ğŸŒŸ',name:'Ğ“Ñ€Ğ¸Ğ¼ Ğ›ĞµĞ³ĞµĞ½Ğ´Ñ‹',           desc:'Ğ£Ğ´Ğ°Ñ€ Ã—20',           cost:5e6,    req:1e6,     type:'click', val:20},

  // ĞĞ²Ñ‚Ğ¾ (Ğ¿Ñ€Ğ¸Ğ·Ñ€Ğ°ĞºĞ¸-Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸ĞºĞ¸) â€” 3 ÑˆÑ‚ÑƒĞºĞ¸
  {id:'u6', icon:'ğŸ‘»',name:'ĞŸÑ€Ğ¸Ğ·Ñ€Ğ°Ğº-ĞŸĞ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº I',     desc:'+3 Ğ°Ğ²Ñ‚Ğ¾/Ñ',          cost:2500,   req:800,     type:'auto',  val:3},
  {id:'u7', icon:'ğŸ‘»',name:'ĞŸÑ€Ğ¸Ğ·Ñ€Ğ°Ğº-ĞŸĞ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº II',    desc:'+10 Ğ°Ğ²Ñ‚Ğ¾/Ñ',         cost:60000,  req:15000,   type:'auto',  val:10},
  {id:'u8', icon:'ğŸ‘»',name:'ĞŸÑ€Ğ¸Ğ·Ñ€Ğ°Ğº-ĞŸĞ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº III',   desc:'+50 Ğ°Ğ²Ñ‚Ğ¾/Ñ',         cost:2e6,    req:500000,  type:'auto',  val:50},

  // Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ â€” 5 ÑˆÑ‚ÑƒĞº
  {id:'u9', icon:'ğŸŒ',name:'Ğ ĞµĞ·Ğ¾Ğ½Ğ°Ğ½Ñ ĞÑ€Ğ´ĞµĞ½Ğ°',        desc:'Ğ’ÑÑ‘ Ã—1.5',           cost:100000, req:20000,   type:'global',val:1.5},
  {id:'u10',icon:'ğŸŒŒ',name:'Ğ¡ĞµÑ€Ğ´Ñ†Ğµ Ğ“Ğ¾Ñ€Ğ¾Ğ´Ğ°',          desc:'Ğ’ÑÑ‘ Ã—2',             cost:2e6,    req:300000,  type:'global',val:2},
  {id:'u11',icon:'ğŸ’«',name:'Ğ’ĞµĞ»Ğ¸ĞºĞ¸Ğ¹ Ğ¡Ğ¼ĞµÑ…',           desc:'Ğ’ÑÑ‘ Ã—3',             cost:5e7,    req:5e6,     type:'global',val:3},
  {id:'u12',icon:'ğŸ”®',name:'ĞĞ¿Ğ¾ĞºĞ°Ğ»Ğ¸Ğ¿ÑĞ¸Ñ Ğ¢ÑŒĞ¼Ñ‹',       desc:'Ğ’ÑÑ‘ Ã—5',             cost:1e9,    req:1e8,     type:'global',val:5},
  {id:'u13',icon:'âœ¨',name:'Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ° ĞÑ€Ğ´ĞµĞ½Ğ°',          desc:'Ğ’ÑÑ‘ Ã—10',            cost:5e10,   req:5e9,     type:'global',val:10},

  // Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ â€” 22 ÑˆÑ‚ÑƒĞºĞ¸
  {id:'u14',icon:'ğŸµ',name:'Ğ¡Ñ‚Ğ°Ñ€Ğ°Ñ ĞŸĞ»Ğ°ÑÑ‚Ğ¸Ğ½ĞºĞ°',       desc:'ĞŸĞ°Ñ‚ĞµÑ„Ğ¾Ğ½ Ã—2',         cost:250,    req:80,      type:'gen', id2:'phonograph',  val:2},
  {id:'u15',icon:'ğŸ•¯ï¸',name:'Ğ’Ğ¾ÑĞºĞ¾Ğ²Ñ‹Ğµ Ğ¡Ğ²ĞµÑ‡Ğ¸',         desc:'Ğ¤Ğ¾Ğ½Ğ°Ñ€ÑŒ Ã—2',          cost:1500,   req:400,     type:'gen', id2:'lantern',     val:2},
  {id:'u16',icon:'ğŸª',name:'Ğ¡ĞµÑ€ĞµĞ±Ñ€ÑĞ½Ğ¾Ğµ Ğ—ĞµÑ€ĞºĞ°Ğ»Ğ¾',     desc:'Ğ“Ñ€Ğ¸Ğ¼Ñ‘Ñ€ĞºĞ° Ã—2',        cost:8000,   req:2000,    type:'gen', id2:'mirror',      val:2},
  {id:'u17',icon:'ğŸŸï¸',name:'Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ ĞœĞµÑÑ‚Ğ°',           desc:'ĞšĞ°ÑÑĞ° Ã—2',           cost:40000,  req:10000,   type:'gen', id2:'booth',       val:2},
  {id:'u18',icon:'ğŸ ',name:'ĞĞ¶Ğ¸Ğ²ÑˆĞ°Ñ ĞšĞ°Ñ€ÑƒÑĞµĞ»ÑŒ',       desc:'ĞšĞ°Ñ€ÑƒÑĞµĞ»ÑŒ Ã—2',        cost:200000, req:60000,   type:'gen', id2:'carousel',    val:2},
  {id:'u19',icon:'ğŸ·',name:'Ğ”Ğ¶Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ğ˜Ğ¼Ğ¿Ñ€Ğ¾Ğ²Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ',  desc:'ĞšĞ²Ğ°Ñ€Ñ‚ĞµÑ‚ Ã—2',         cost:800000, req:200000,  type:'gen', id2:'jazz',        val:2},
  {id:'u20',icon:'ğŸ¹',name:'ĞĞ¾ĞºÑ‚ÑÑ€Ğ½ Ğ¢ÑŒĞ¼Ñ‹',           desc:'ĞŸĞ¸Ğ°Ğ½Ğ¸Ğ½Ğ¾ Ã—2',         cost:3e6,    req:800000,  type:'gen', id2:'piano',       val:2},
  {id:'u21',icon:'ğŸª',name:'ĞœĞ°ÑÑ‚ĞµÑ€ ĞšĞ»Ğ¾ÑƒĞ½Ğ°Ğ´Ñ‹',        desc:'ĞšĞ»Ğ¾ÑƒĞ½ Ã—2',           cost:1.2e7,  req:3e6,     type:'gen', id2:'clown',       val:2},
  {id:'u22',icon:'ğŸ“š',name:'Ğ—Ğ°Ğ¿Ñ€ĞµÑ‚Ğ½Ñ‹Ğµ Ğ¢Ğ¾Ğ¼Ğ°',          desc:'Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ã—2',      cost:5e7,    req:1.2e7,   type:'gen', id2:'library',     val:2},
  {id:'u23',icon:'ğŸª©',name:'Ğ¢Ğ°Ğ½ĞµÑ† Ğ¡Ğ²ĞµÑ‚Ğ°',            desc:'Ğ—ĞµÑ€ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑˆĞ°Ñ€ Ã—2',  cost:2e8,    req:5e7,     type:'gen', id2:'mirrorball',  val:2},
  {id:'u24',icon:'ğŸ’',name:'Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„ÑĞºĞ¸Ğ¹ ĞŸĞ¸Ğ³Ğ¼ĞµĞ½Ñ‚',    desc:'Ğ¨ĞºĞ°Ñ‚ÑƒĞ»ĞºĞ° Ã—2',        cost:1e9,    req:2e8,     type:'gen', id2:'casket',      val:2},
  {id:'u25',icon:'ğŸ­',name:'Ğ—Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ¡Ñ†ĞµĞ½Ñ‹',           desc:'Ğ¢Ñ€ÑƒĞ¿Ğ¿Ğ° Ã—2',          cost:5e9,    req:1e9,     type:'gen', id2:'troupe',      val:2},
  {id:'u26',icon:'ğŸŒ™',name:'Ğ¢Ğ°Ğ¹Ğ½Ñ‹Ğ¹ ĞĞºÑ‚',             desc:'Ğ’Ğ°Ñ€ÑŒĞµÑ‚Ğµ Ã—2',         cost:2e10,   req:5e9,     type:'gen', id2:'varietee',    val:2},
  {id:'u27',icon:'ğŸšª',name:'Ğ—Ğ°Ğ¿Ñ€ĞµÑ‰Ñ‘Ğ½Ğ½Ğ°Ñ ĞŸĞ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°', desc:'Ğ¢ĞµĞ°Ñ‚Ñ€ Ã—2',           cost:1e11,   req:2e10,    type:'gen', id2:'underground', val:2},
  {id:'u28',icon:'âš—ï¸',name:'Ğ­Ğ»Ğ¸ĞºÑĞ¸Ñ€ Ğ¡Ğ¼ĞµÑ…Ğ°',          desc:'Ğ›Ğ°Ğ±Ğ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¸Ñ Ã—2',     cost:5e11,   req:1e11,    type:'gen', id2:'alchemy',     val:2},
  {id:'u29',icon:'ğŸ“œ',name:'Ğ¡ĞµĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ ĞœĞ°Ğ½ÑƒÑĞºÑ€Ğ¸Ğ¿Ñ‚',   desc:'ĞÑ€Ñ…Ğ¸Ğ² Ã—2',           cost:2e12,   req:5e11,    type:'gen', id2:'archive',     val:2},
  {id:'u30',icon:'ğŸ¡',name:'ĞšÑƒĞ¿Ğ¾Ğ» ĞœĞ¸Ñ€Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ',       desc:'Ğ¦Ğ¸Ñ€Ğº Ã—2',            cost:1e13,   req:2e12,    type:'gen', id2:'circus',      val:2},
  {id:'u31',icon:'ğŸª”',name:'Ğ’ĞµÑ‡Ğ½Ñ‹Ğ¹ ĞĞ³Ğ¾Ğ½ÑŒ',           desc:'ĞĞ»Ñ‚Ğ°Ñ€ÑŒ Ã—2',          cost:5e13,   req:1e13,    type:'gen', id2:'altar',       val:2},
  {id:'u32',icon:'ğŸ—¼',name:'Ğ­Ñ…Ğ¾ Ğ’ĞµÑ‡Ğ½Ğ¾ÑÑ‚Ğ¸',           desc:'Ğ‘Ğ°ÑˆĞ½Ñ Ã—2',           cost:2e14,   req:5e13,    type:'gen', id2:'tower',       val:2},
  {id:'u33',icon:'â¤ï¸â€ğŸ”¥',name:'Ğ–Ğ¸Ğ²Ğ¾Ğµ Ğ¡ĞµÑ€Ğ´Ñ†Ğµ',         desc:'Ğ¡ĞµÑ€Ğ´Ñ†Ğµ Ã—2',          cost:1e15,   req:2e14,    type:'gen', id2:'heart',       val:2},
  {id:'u34',icon:'ğŸ”®',name:'Ğ˜ÑÑ‚Ğ¸Ğ½Ğ° ĞÑ‚Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹',       desc:'Ğ—ĞµÑ€ĞºĞ°Ğ»Ğ¾ Ğ¸ÑÑ‚Ğ¸Ğ½Ñ‹ Ã—2',  cost:5e15,   req:1e15,    type:'gen', id2:'truthmirror', val:2},
  {id:'u35',icon:'ğŸŒ€',name:'Ğ’Ñ€Ğ°Ñ‚Ğ° ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹',          desc:'Ğ’Ñ€Ğ°Ñ‚Ğ° Ã—2',           cost:2e16,   req:5e15,    type:'gen', id2:'gates',       val:2},
];

// 10 Ğ”Ğ°Ñ€Ğ¾Ğ² ĞÑ€Ğ´ĞµĞ½Ğ° (Stars)
const STARS_ITEMS=[
  {id:'frenzy',       icon:'ğŸ”¥',name:'Ğ¯Ñ€Ğ¾ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¡Ğ¼ĞµÑ…',       desc:'Ã—3 ĞºĞ¾ Ğ²ÑĞµĞ¼Ñƒ Ğ½Ğ° 30 Ğ¼Ğ¸Ğ½',         stars:25,  badge:'Ğ¥Ğ˜Ğ¢'},
  {id:'autoclick',    icon:'ğŸ‘»',name:'ĞŸÑ€Ğ¸Ğ·Ñ€Ğ°Ğº-Ğ¡Ñ‚Ñ€Ğ°Ğ¶',        desc:'+100 Ğ¡Ğ¼ĞµÑ…Ğ°/Ñ Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ°',          stars:50,  badge:''},
  {id:'x5',           icon:'ğŸ­',name:'ĞœĞ°ÑĞºĞ° Ğ¡Ğ¸Ğ»Ñ‹',           desc:'Ã—5 ĞºĞ¾ Ğ²ÑĞµĞ¼Ñƒ Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ°',           stars:100, badge:'Ğ¢ĞĞŸ'},
  {id:'prestige',     icon:'âœ¨',name:'Ğ’Ğ¾ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ±ĞµĞ· ĞŸĞ¾Ñ‚ĞµÑ€ÑŒ',desc:'Ğ’Ğ¾ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ±ĞµĞ· ÑĞ±Ñ€Ğ¾ÑĞ°',         stars:200, badge:''},
  {id:'offline_plus', icon:'ğŸŒ™',name:'ĞĞ¾Ñ‡Ğ½Ğ°Ñ Ğ¡Ñ‚Ñ€Ğ°Ğ¶Ğ°',        desc:'ĞÑ„Ğ»Ğ°Ğ¹Ğ½ Ğ´Ğ¾Ñ…Ğ¾Ğ´ Ğ´Ğ¾ 12 Ñ‡Ğ°ÑĞ¾Ğ²',       stars:30,  badge:''},
  {id:'crit_boost',   icon:'ğŸ’¥',name:'Ğ˜ÑĞºÑ€ĞµĞ½Ğ½Ğ¸Ğ¹ Ğ¡Ğ¼ĞµÑ…',       desc:'ĞšÑ€Ğ¸Ñ‚ ÑˆĞ°Ğ½Ñ +20% Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ°',        stars:75,  badge:''},
  {id:'combo_extend', icon:'â›“ï¸',name:'ĞĞµÑĞºĞ¾Ğ½Ñ‡Ğ°ĞµĞ¼Ğ°Ñ Ğ¦ĞµĞ¿Ğ¾Ñ‡ĞºĞ°', desc:'ĞšĞ¾Ğ¼Ğ±Ğ¾ Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€ Ã—3 Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ°',       stars:60,  badge:''},
  {id:'sister_blessing',icon:'ğŸŒ¸',name:'Ğ‘Ğ»Ğ°Ğ³Ğ¾ÑĞ»Ğ¾Ğ²ĞµĞ½Ğ¸Ğµ Ğ¡ĞµÑÑ‚Ñ‘Ñ€',desc:'Ğ’ÑĞµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ +25% Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ°',   stars:150, badge:'Ğ Ğ•Ğ”ĞšĞ'},
  {id:'vip',          icon:'ğŸ‘‘',name:'VIP Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒ',        desc:'ĞÑĞ¾Ğ±Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ + ÑĞºÑĞºĞ»ÑĞ·Ğ¸Ğ²',      stars:300, badge:'VIP'},
  {id:'story_unlock', icon:'ğŸ“–',name:'Ğ¥Ñ€Ğ¾Ğ½Ğ¸ĞºĞ° ĞÑ€Ğ´ĞµĞ½Ğ°',       desc:'ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ‚Ğ°Ğ¹Ğ½ÑƒÑ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ',         stars:50,  badge:''},
];

/* â•â• SISTERS DATA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ° â€” Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ push Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ ÑÑĞ´Ğ°.
// img: { skinId: 'url Ğ¸Ğ»Ğ¸ base64' } â€” Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ ĞºĞ¾Ğ³Ğ´Ğ° ĞµÑÑ‚ÑŒ Ğ°Ñ€Ñ‚.
const SISTERS=[
  {
    id:'mara',
    name:'ĞœĞ°Ñ€Ğ°',
    title:'ĞÑ…Ğ¾Ñ‚Ğ½Ğ¸Ñ†Ğ°',
    icon:'ğŸ—¡ï¸',
    desc:'ĞŸĞµÑ€Ğ²Ğ¾Ğ¹ Ğ¸Ğ´Ñ‘Ñ‚ Ğ² Ğ±Ğ¾Ğ¹. Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑƒĞ´Ğ°Ñ€ â€” ĞµÑ‘ ÑĞ·Ñ‹Ğº. ĞšÑ€Ğ°ÑĞ½Ñ‹Ğ¹ Ğ³Ñ€Ğ¸Ğ¼ ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ ÑÑ€Ğ¾ÑÑ‚ÑŒ.',
    specialty:'click',          // ĞºĞ°Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ ĞºĞ»Ğ¸ĞºĞ¾Ğ²
    xpThresholds:[100,300,700,1500,3000,6000,12000,25000,50000], // 9 Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ² = 10 ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹
    bonuses:[                   // Ğ±Ğ¾Ğ½ÑƒÑ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ¼ ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ
      {level:3, desc:'+1 Ğº ÑĞ¸Ğ»Ğµ ÑƒĞ´Ğ°Ñ€Ğ°',   type:'clickFlat', val:1},
      {level:5, desc:'Ğ£Ğ´Ğ°Ñ€ Ã—1.5',         type:'clickMult', val:1.5},
      {level:7, desc:'+5% ÑˆĞ°Ğ½Ñ ĞºÑ€Ğ¸Ñ‚Ğ°',    type:'critBonus', val:0.05},
      {level:10,desc:'Ğ£Ğ´Ğ°Ñ€ Ã—2 (Ğ¸Ñ‚Ğ¾Ğ³Ğ¾)',   type:'clickMult', val:2},
    ],
    skins:[
      {id:'default',     name:'ĞÑ…Ğ¾Ñ‚Ğ½Ğ¸Ñ†Ğ°',      type:'free',        unlockLevel:0,  icon:'ğŸ—¡ï¸'},
      {id:'scarlet',     name:'ĞĞ»Ğ°Ñ',          type:'progression', unlockLevel:5,  icon:'ğŸ”´'},
      {id:'shadow',      name:'Ğ¢ĞµĞ½ÑŒ',          type:'progression', unlockLevel:9,  icon:'ğŸ–¤'},
      {id:'crimson',     name:'Ğ‘Ğ°Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ',      type:'stars',       price:75,       icon:'ğŸ‘‘'},
      {id:'void',        name:'Ğ’Ğ¾Ğ¹Ğ´',          type:'stars',       price:200,      icon:'ğŸŒ‘'},
    ],
    unlockCondition:{type:'free'},
    img:{default:'mara.png'},  // Ğ°Ñ€Ñ‚ ĞœĞ°Ñ€Ñ‹ â€” ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸ mara.png Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ Downloads
  },
  {
    id:'lily',
    name:'Ğ›Ğ¸Ğ»Ğ¸',
    title:'Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¸Ñ†Ğ°',
    icon:'ğŸŒ¸',
    desc:'Ğ¢Ğ¸Ñ…Ğ°Ñ ÑĞ¸Ğ»Ğ° ĞÑ€Ğ´ĞµĞ½Ğ°. Ğ‘ĞµĞ»Ñ‹Ğ¹ Ğ³Ñ€Ğ¸Ğ¼, ÑĞµÑ€ĞµĞ±Ñ€ÑĞ½Ñ‹Ğµ Ñ†Ğ²ĞµÑ‚Ñ‹. Ğ•Ñ‘ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ğ¿Ğ¾ĞºĞ° Ğ¾Ğ½Ğ° Ğ¼Ğ¾Ğ»Ñ‡Ğ¸Ñ‚.',
    specialty:'cps',            // ĞºĞ°Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ°ÑÑĞ¸Ğ²Ğ½Ğ¾
    xpThresholds:[100,300,700,1500,3000,6000,12000,25000,50000],
    bonuses:[
      {level:3, desc:'+10% ĞºĞ¾ Ğ²ÑĞµĞ¼ CPS',  type:'cpsMult',   val:0.10},
      {level:5, desc:'+20% ĞºĞ¾ Ğ²ÑĞµĞ¼ CPS',  type:'cpsMult',   val:0.20},
      {level:7, desc:'ĞÑ„Ğ»Ğ°Ğ¹Ğ½ +1Ñ‡',        type:'offlineH',  val:1},
      {level:10,desc:'+50% ĞºĞ¾ Ğ²ÑĞµĞ¼ CPS',  type:'cpsMult',   val:0.50},
    ],
    skins:[
      {id:'default',     name:'Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¸Ñ†Ğ°', type:'free',        unlockLevel:0,  icon:'ğŸŒ¸'},
      {id:'silver',      name:'Ğ¡ĞµÑ€ĞµĞ±Ñ€ÑĞ½Ğ°Ñ',    type:'progression', unlockLevel:5,  icon:'ğŸ¤'},
      {id:'moonlight',   name:'Ğ›ÑƒĞ½Ğ½Ğ°Ñ',        type:'progression', unlockLevel:9,  icon:'ğŸŒ•'},
      {id:'ethereal',    name:'Ğ­Ñ„Ğ¸Ñ€Ğ½Ğ°Ñ',       type:'stars',       price:75,       icon:'âœ¨'},
      {id:'dawn',        name:'Ğ Ğ°ÑÑĞ²ĞµÑ‚',       type:'stars',       price:'event',  icon:'ğŸŒ…'},
    ],
    unlockCondition:{type:'totalEver', val:2000},
    img:{default:'lily.png'},
  },
  {
    id:'koko',
    name:'ĞšĞ¾ĞºĞ¾',
    title:'Ğ¥Ğ°Ğ¾Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ',
    icon:'ğŸª',
    desc:'Ğ¡Ğ¼ĞµÑ… â€” ĞµÑ‘ ÑÑ‚Ğ¸Ñ…Ğ¸Ñ. Ğ¯Ñ€ĞºĞ¸Ğ¹ Ğ³Ñ€Ğ¸Ğ¼, Ğ½ĞµĞ¿Ñ€ĞµĞ´ÑĞºĞ°Ğ·ÑƒĞµĞ¼Ñ‹Ğµ Ğ°Ñ‚Ğ°ĞºĞ¸. ĞšÑ€Ğ¸Ñ‚ â€” ÑÑ‚Ğ¾ ĞµÑ‘ ĞºĞ¾Ğ¼Ğ¿Ğ»Ğ¸Ğ¼ĞµĞ½Ñ‚.',
    specialty:'crit',           // ĞºĞ°Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ ĞºÑ€Ğ¸Ñ‚Ğ¾Ğ²
    xpThresholds:[100,300,700,1500,3000,6000,12000,25000,50000],
    bonuses:[
      {level:3, desc:'+5% ÑˆĞ°Ğ½Ñ ĞºÑ€Ğ¸Ñ‚Ğ°',    type:'critBonus', val:0.05},
      {level:5, desc:'ĞšÑ€Ğ¸Ñ‚ ÑƒÑ€Ğ¾Ğ½ Ã—1.5',    type:'critDmg',   val:1.5},
      {level:7, desc:'+10% ÑˆĞ°Ğ½Ñ ĞºÑ€Ğ¸Ñ‚Ğ°',   type:'critBonus', val:0.10},
      {level:10,desc:'ĞšÑ€Ğ¸Ñ‚ ÑƒÑ€Ğ¾Ğ½ Ã—2',      type:'critDmg',   val:2},
    ],
    skins:[
      {id:'default',     name:'Ğ¥Ğ°Ğ¾Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ',     type:'free',        unlockLevel:0,  icon:'ğŸª'},
      {id:'confetti',    name:'ĞšĞ¾Ğ½Ñ„ĞµÑ‚Ñ‚Ğ¸',      type:'progression', unlockLevel:5,  icon:'ğŸŠ'},
      {id:'neon',        name:'ĞĞµĞ¾Ğ½',          type:'progression', unlockLevel:9,  icon:'ğŸ’¡'},
      {id:'rainbow',     name:'Ğ Ğ°Ğ´ÑƒĞ³Ğ°',        type:'stars',       price:75,       icon:'ğŸŒˆ'},
      {id:'chaos',       name:'ĞĞ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ñ‹Ğ¹ Ğ¥Ğ°Ğ¾Ñ',type:'stars',      price:200,      icon:'ğŸŒ€'},
    ],
    unlockCondition:{type:'prestige', val:1},
    img:{default:'koko.png'},
  },
];

const SISTER_XP_PER_CLICK=1;       // ĞœĞ°Ñ€Ğ°: XP Ğ·Ğ° ĞºĞ»Ğ¸Ğº
const SISTER_XP_PER_CRIT=10;       // ĞšĞ¾ĞºĞ¾: XP Ğ·Ğ° ĞºÑ€Ğ¸Ñ‚
const SISTER_XP_PER_SEC=0.5;       // Ğ›Ğ¸Ğ»Ğ¸: XP Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ

const PRESTIGE_GOAL=1000000;
const TITLES=[
  'Ğ¡ĞĞ§Ğ£Ğ’Ğ¡Ğ¢Ğ’Ğ£Ğ®Ğ©Ğ˜Ğ™','ĞŸĞĞ¡Ğ›Ğ£Ğ¨ĞĞ˜Ğš','Ğ¥Ğ ĞĞĞ˜Ğ¢Ğ•Ğ›Ğ¬',
  'Ğ¡Ğ¢Ğ ĞĞ– Ğ¡ĞœĞ•Ğ¥Ğ','ĞœĞĞ¡Ğ¢Ğ•Ğ  Ğ¡ĞœĞ•Ğ¥Ğ','Ğ›Ğ•Ğ“Ğ•ĞĞ”Ğ ĞĞ Ğ”Ğ•ĞĞ',
  'Ğ¡Ğ¢ĞĞ Ğ•Ğ™Ğ¨Ğ˜ĞĞ','Ğ’Ğ•Ğ›Ğ˜ĞšĞ˜Ğ™ Ğ¥Ğ ĞĞĞ˜Ğ¢Ğ•Ğ›Ğ¬'
];

/* â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let G={
  energy:0,totalEver:0,clicks:0,
  prestige:0,prestigeMult:1,level:1,
  gens:{},upgs:{},stars:{},
  friends:[],friendBonus:0,
  combo:1,comboTimer:0,
  lastClick:0,
  frenzyExpiresAt:0,
  // Sister system
  sisterXp:{mara:0,lily:0,koko:0},
  sisterSkin:{mara:'default',lily:'default',koko:'default'},
};

/* â•â• COMPUTED â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let clickPow=1,autoCps=0,globalMult=1,genMults={};
let critChanceBonus=0,comboTimerMult=1,offlineCapHours=2;
let critDmgMult=5; // base crit damage

/* â•â• SISTER HELPERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getSisterLevel(id){
  const s=SISTERS.find(x=>x.id===id);
  if(!s)return 0;
  const xp=G.sisterXp[id]||0;
  let lv=1;
  let acc=0;
  for(let i=0;i<s.xpThresholds.length;i++){
    acc+=s.xpThresholds[i];
    if(xp>=acc)lv=i+2; else break;
  }
  return Math.min(lv,10);
}

function getSisterXpPct(id){
  const s=SISTERS.find(x=>x.id===id);
  if(!s)return 0;
  const xp=G.sisterXp[id]||0;
  let lv=getSisterLevel(id);
  if(lv>=10)return 100;
  let acc=0;
  for(let i=0;i<lv-1;i++)acc+=s.xpThresholds[i];
  const cur=xp-acc;
  const need=s.xpThresholds[lv-1];
  return Math.min(100,(cur/need)*100);
}

function isSisterUnlocked(s){
  if(s.unlockCondition.type==='free')return true;
  if(s.unlockCondition.type==='totalEver')return G.totalEver>=s.unlockCondition.val;
  if(s.unlockCondition.type==='prestige')return G.prestige>=s.unlockCondition.val;
  return false;
}

function isSkinUnlocked(sister,skin){
  if(skin.type==='free')return true;
  if(skin.type==='progression')return getSisterLevel(sister.id)>=skin.unlockLevel;
  if(skin.type==='stars')return !!(G.stars[`skin_${sister.id}_${skin.id}`]);
  if(skin.type==='event')return !!(G.stars[`skin_${sister.id}_${skin.id}`]);
  return false;
}

function gainSisterXp(id,amount){
  if(!isSisterUnlocked(SISTERS.find(x=>x.id===id)))return;
  const prevLv=getSisterLevel(id);
  G.sisterXp[id]=(G.sisterXp[id]||0)+amount;
  const newLv=getSisterLevel(id);
  if(newLv>prevLv){
    const s=SISTERS.find(x=>x.id===id);
    tg?.HapticFeedback?.notificationOccurred('success');
    showToast(`âœ¨ ${s.name} â€” Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ${newLv}! ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ!`);
    recalc();
  }
}

function recalc(){
  clickPow=1;autoCps=0;globalMult=1;genMults={};
  critChanceBonus=0;comboTimerMult=1;offlineCapHours=2;critDmgMult=5;

  UPGRADES.forEach(u=>{
    if(!G.upgs[u.id])return;
    if(u.type==='click')  clickPow*=u.val;
    if(u.type==='auto')   autoCps+=u.val;
    if(u.type==='global') globalMult*=u.val;
    if(u.type==='gen')    genMults[u.id2]=(genMults[u.id2]||1)*u.val;
  });

  if(G.stars['autoclick'])       autoCps+=100;
  if(G.stars['x5'])              globalMult*=5;
  if(G.stars['frenzy_active'])   globalMult*=3;
  if(G.stars['sister_blessing']) globalMult*=1.25;
  if(G.stars['crit_boost'])      critChanceBonus+=0.20;
  if(G.stars['combo_extend'])    comboTimerMult=3;
  if(G.stars['offline_plus'])    offlineCapHours=12;
  if(G.friendBonus>0)            globalMult*=(1+G.friendBonus/100);

  // Sister bonuses (apply unlocked bonuses up to current level)
  SISTERS.forEach(s=>{
    if(!isSisterUnlocked(s))return;
    const lv=getSisterLevel(s.id);
    s.bonuses.forEach(b=>{
      if(lv<b.level)return;
      if(b.type==='clickFlat')  clickPow+=b.val;
      if(b.type==='clickMult')  clickPow*=b.val;
      if(b.type==='critBonus')  critChanceBonus+=b.val;
      if(b.type==='critDmg')    critDmgMult*=b.val;
      if(b.type==='cpsMult')    globalMult*=(1+b.val);
      if(b.type==='offlineH')   offlineCapHours+=b.val;
    });
  });
}

function calcCps(){
  let t=0;
  GENS.forEach(g=>{
    const own=G.gens[g.id]||0;
    const gm=genMults[g.id]||1;
    t+=own*g.baseCps*gm;
  });
  t+=autoCps*clickPow;
  return t*globalMult*G.prestigeMult;
}

function effectiveClick(){
  const base=clickPow*globalMult*G.prestigeMult;
  return base*G.combo;
}

/* â•â• FORMAT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function fmt(n){
  if(n<1000)return Math.floor(n).toString();
  const s=['','K','M','B','T','Qa','Qi','Sx','Sp'];
  let i=0;
  while(n>=1000&&i<s.length-1){n/=1000;i++;}
  return n.toFixed(2)+s[i];
}

/* â•â• COMBO SYSTEM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const COMBO_TIMEOUT_BASE=3000;
const COMBO_MAX=5;

function getComboTimeout(){return COMBO_TIMEOUT_BASE*comboTimerMult;}

function addCombo(){
  G.combo=Math.min(COMBO_MAX,G.combo+.1);
  G.comboTimer=getComboTimeout();
}
function decayCombo(dt){
  if(G.comboTimer>0){
    G.comboTimer-=dt*1000;
    if(G.comboTimer<=0){G.combo=1;G.comboTimer=0;}
  }
}

/* â•â• CLICK â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _lastTap=0;
function handleClick(){
  tg?.HapticFeedback?.impactOccurred('light');
  const critChance=.1+critChanceBonus;
  const isCrit=Math.random()<critChance;
  const gain=effectiveClick()*(isCrit?critDmgMult:1);
  G.energy+=gain;G.totalEver+=gain;G.clicks++;
  addCombo();
  checkLevel();

  const p=document.createElement('div');
  p.className='ptc'+(isCrit?' ptc-crit':'');
  p.textContent=(isCrit?'ĞšĞ Ğ˜Ğ¢ x5! +':'+')+fmt(gain);
  const r=document.getElementById('mainBtn').getBoundingClientRect();
  const jx=(Math.random()-.5)*70, jy=(Math.random()-.5)*30;
  p.style.left=(r.left+r.width/2+jx)+'px';
  p.style.top=(r.top+r.height/3+jy)+'px';
  const hue=isCrit?30:[330,280,45][Math.floor(Math.random()*3)];
  p.style.color=`hsl(${hue},100%,70%)`;
  p.style.textShadow=`0 0 10px hsl(${hue},100%,70%)`;
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),900);

  // Sister XP
  gainSisterXp('mara', SISTER_XP_PER_CLICK);
  if(isCrit){
    gainSisterXp('koko', SISTER_XP_PER_CRIT);
    tg?.HapticFeedback?.notificationOccurred('success');
    showToast(`Ğ˜Ğ¡ĞšĞ Ğ•ĞĞĞ˜Ğ™ Ğ¡ĞœĞ•Ğ¥ â€” ĞšĞ Ğ˜Ğ¢ Ã—${critDmgMult}!`);
  }
}

const _mainBtn=document.getElementById('mainBtn');
_mainBtn.addEventListener('touchstart',function(e){
  e.preventDefault();
  const now=Date.now();
  if(now-_lastTap<80)return;
  _lastTap=now;
  handleClick();
},{passive:false});
_mainBtn.addEventListener('click',function(){
  if(Date.now()-_lastTap<300)return;
  handleClick();
});

/* â•â• LEVELS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LEVEL_THRESHOLDS=[0,100,500,2000,10000,50000,200000,1000000,5000000,20000000];
function checkLevel(){
  const lvl=LEVEL_THRESHOLDS.filter(t=>G.totalEver>=t).length;
  if(lvl>G.level){
    G.level=lvl;
    showLevelUp();
    showToast(`ğŸ–ï¸ Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ ${G.level} â€” ${TITLES[Math.min(G.level-1,TITLES.length-1)]}!`);
  }
}
function showLevelUp(){
  const el=document.createElement('div');
  el.className='levelup';
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),700);
}

/* â•â• BUY GEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buyGen(id){
  const g=GENS.find(x=>x.id===id);
  const cost=Math.floor(g.baseCost*Math.pow(1.15,G.gens[id]||0));
  if(G.energy<cost)return;
  G.energy-=cost;
  G.gens[id]=(G.gens[id]||0)+1;
}

/* â•â• BUY UPGRADE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buyUpg(id){
  const u=UPGRADES.find(x=>x.id===id);
  if(!u||G.upgs[id])return;
  if(G.energy<u.cost||G.totalEver<u.req)return;
  G.energy-=u.cost;
  G.upgs[id]=true;
  recalc();
  showToast(`âœ… ${u.name} â€” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!`);
}

/* â•â• BUY STARS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function applyStarsPurchase(id){
  if(id==='frenzy'){
    const dur=30*60*1000;
    G.stars['frenzy_active']=true;
    G.frenzyExpiresAt=Date.now()+dur;
    recalc();
    showToast('Ğ¯Ğ ĞĞ¡Ğ¢ĞĞ«Ğ™ Ğ¡ĞœĞ•Ğ¥ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ° 30 Ğ¼Ğ¸Ğ½!');
    setTimeout(()=>{delete G.stars['frenzy_active'];G.frenzyExpiresAt=0;recalc();save();showToast('Ğ¯Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¡Ğ¼ĞµÑ…Ğ° ÑƒĞ³Ğ°ÑĞ»Ğ°...');},dur);
  }else if(id==='prestige'){
    G.prestige++;G.prestigeMult=1+G.prestige*.5;
    recalc();
    showToast(`Ğ’Ğ¾ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ã—${G.prestige} â€” Ğ±ĞµĞ· Ğ¿Ğ¾Ñ‚ĞµÑ€ÑŒ!`);
  }else{
    G.stars[id]=true;recalc();
    const item=STARS_ITEMS.find(x=>x.id===id);
    showToast(`${item.name} â€” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!`);
  }
  save();
}

// true = Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Telegram Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼; false = Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€/dev
const IN_TELEGRAM = !!TGU;

function buyStars(id){
  const item=STARS_ITEMS.find(x=>x.id===id);
  if(!item)return;
  if(IN_TELEGRAM && tg?.openInvoice){
    // TODO: fetch invoiceUrl from bot backend, then:
    // tg.openInvoice(invoiceUrl, s=>{ if(s==='paid') applyStarsPurchase(id); });
    showToast('Ğ”Ğ°Ñ€Ñ‹ ĞÑ€Ğ´ĞµĞ½Ğ°: Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸ Ğ±ÑĞºĞµĞ½Ğ´ Ğ² bot.py');
    return;
  }
  // Browser DEMO
  showToast(`[DEMO] ${item.name} â€” ${item.stars} Stars`);
  applyStarsPurchase(id);
}

/* â•â• SKIN PURCHASE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buyStarsSkin(sisterId, skinId){
  const sister=SISTERS.find(s=>s.id===sisterId);
  if(!sister)return;
  const skin=sister.skins.find(sk=>sk.id===skinId);
  if(!skin||skin.type!=='stars')return;

  const starsKey=`skin_${sisterId}_${skinId}`;
  if(G.stars[starsKey]){showToast('Ğ¡ĞºĞ¸Ğ½ ÑƒĞ¶Ğµ ĞºÑƒĞ¿Ğ»ĞµĞ½!');return;}

  const price=skin.price;

  if(IN_TELEGRAM && tg?.openInvoice){
    // TODO: fetch(`/api/skin_invoice?sisterId=${sisterId}&skinId=${skinId}`)
    //   .then(r=>r.json()).then(d=>tg.openInvoice(d.url, s=>{ if(s==='paid') _applySkinPurchase(...) }))
    showToast(`Ğ¡ĞºĞ¸Ğ½ Â«${skin.name}Â» â€” ${price} Stars. ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸ Ğ±ÑĞºĞµĞ½Ğ´!`);
    return;
  }

  // DEMO Ñ€ĞµĞ¶Ğ¸Ğ¼ (Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€) â€” Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµĞ¼ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
  const msg=`[DEMO] Ğ¡ĞºĞ¸Ğ½ Â«${skin.name}Â» Ğ´Ğ»Ñ ${sister.name}?`;
  if(tg?.showPopup && tg.isVersionAtLeast?.('6.2')){
    tg.showPopup({
      title:`Ğ¡ĞºĞ¸Ğ½ Â«${skin.name}Â»`,
      message:msg,
      buttons:[{id:'ok',type:'ok',text:'ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ'},{id:'cancel',type:'cancel',text:'ĞÑ‚Ğ¼ĞµĞ½Ğ°'}]
    },(btn)=>{ if(btn==='ok') _applySkinPurchase(sisterId, skinId, skin, starsKey); });
  } else {
    if(confirm(msg+`\n${price} Stars`))
      _applySkinPurchase(sisterId, skinId, skin, starsKey);
  }
}

function _applySkinPurchase(sisterId, skinId, skin, starsKey){
  G.stars[starsKey]=true;
  G.sisterSkin[sisterId]=skinId;
  save();
  renderSisters();
  showToast(`âœ¨ Ğ¡ĞºĞ¸Ğ½ Â«${skin.name}Â» â€” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!`);
  tg?.HapticFeedback?.notificationOccurred('success');
}

/* â•â• ART LOADER (Ğ´Ğ»Ñ Ğ°Ñ€Ñ‚Ğ° Ğ¸Ğ· Grok) â•â•â•â•â•â•â•â•â•â• */
// ĞšĞ¾Ğ³Ğ´Ğ° Ñƒ Ñ‚ĞµĞ±Ñ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğ°Ñ€Ñ‚ â€” Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¸:
// SISTERS.find(s=>s.id==='mara').img['default'] = 'data:image/png;base64,...'
// Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ URL: SISTERS.find(s=>s.id==='mara').img['default'] = 'img/mara.png'
// ĞŸĞ¾ÑĞ»Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¸ renderSisters() â€” Ğ°Ñ€Ñ‚ Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸.
function loadSisterArt(sisterId, skinId, url){
  const s=SISTERS.find(x=>x.id===sisterId);
  if(s) s.img[skinId]=url;
  renderSisters();
}

/* â•â• PRESTIGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('prestigeBtn').addEventListener('click',function(){
  if(G.totalEver<PRESTIGE_GOAL)return;
  const doPrestige=()=>{
    tg?.HapticFeedback?.notificationOccurred('success');
    G.prestige++;G.prestigeMult=1+G.prestige*.5;
    G.energy=0;G.totalEver=0;G.clicks=0;G.level=1;
    G.gens={};G.upgs={};G.combo=1;G.comboTimer=0;
    recalc();save();
    showToast(`Ğ’ĞĞ¡Ğ¥ĞĞ–Ğ”Ğ•ĞĞ˜Ğ• Ã—${G.prestige}! Ğ‘Ğ¾Ğ½ÑƒÑ +${G.prestige*50}%`);
  };
  if(tg?.isVersionAtLeast?.('6.2')){
    tg.showPopup({
      title:'Ğ’ĞĞ¡Ğ¥ĞĞ–Ğ”Ğ•ĞĞ˜Ğ•',
      message:`Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ñ‹Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ +${(G.prestige+1)*50}%?`,
      buttons:[
        {id:'ok',type:'destructive',text:'Ğ’ĞĞ¡Ğ¥ĞĞ–Ğ”Ğ•ĞĞ˜Ğ•'},
        {id:'cancel',type:'cancel',text:'ĞÑ‚Ğ¼ĞµĞ½Ğ°'}
      ]
    },(btnId)=>{if(btnId==='ok')doPrestige();});
  }else{
    if(confirm(`Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ +${(G.prestige+1)*50}% Ğ½Ğ°Ğ²ÑĞµĞ³Ğ´Ğ°?`))doPrestige();
  }
});

/* â•â• MILESTONES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const MS=[
  {v:100,       m:'ğŸ•¯ï¸ 100 â€” Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¡Ğ¼ĞµÑ… Ğ·Ğ°Ğ¶Ğ¶Ñ‘Ğ½!'},
  {v:1000,      m:'ğŸ­ 1,000 â€” Ğ¢ĞµĞ½Ğ¸ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°ÑÑ‚!'},
  {v:10000,     m:'ğŸ”¥ 10,000 â€” ĞÑ€Ğ´ĞµĞ½ Ğ¿Ñ€Ğ¾ÑÑ‹Ğ¿Ğ°ĞµÑ‚ÑÑ!'},
  {v:100000,    m:'ğŸ’„ 100K â€” Ğ¡Ñ‘ÑÑ‚Ñ€Ñ‹ Ğ·Ğ°Ğ¼ĞµÑ‡Ğ°ÑÑ‚ Ñ‚ĞµĞ±Ñ!'},
  {v:1000000,   m:'ğŸŒ¹ ĞœĞ¸Ğ»Ğ»Ğ¸Ğ¾Ğ½ â€” Ğ¿Ğ¾Ñ€Ğ° Ğº Ğ’Ğ¾ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ!'},
  {v:1000000000,m:'âœ¨ ĞœĞ˜Ğ›Ğ›Ğ˜ĞĞ Ğ” â€” Ñ‚Ñ‹ Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ° ĞÑ€Ğ´ĞµĞ½Ğ°!'},
];
const _ms=new Set();
function checkMS(){MS.forEach(m=>{if(G.totalEver>=m.v&&!_ms.has(m.v)){_ms.add(m.v);showToast(m.m);}});}

/* â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(msg){
  const t=document.createElement('div');
  t.className='toast';t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),3100);
}

/* â•â• TABS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click',function(){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    this.classList.add('active');
    document.getElementById('page-'+this.dataset.tab).classList.add('active');
    if(this.dataset.tab==='sisters') renderSisters();
  });
});

/* â•â• RENDER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _lastRender=0,_lastShopRender=0;
function render(now){
  if(now-_lastRender<50)return;
  _lastRender=now;

  const cps=calcCps();
  const ec=effectiveClick();

  document.getElementById('scoreNum').textContent=fmt(G.energy);
  document.getElementById('scoreCps').textContent='+'+fmt(cps)+'/Ñ';
  document.getElementById('hTotal').textContent=fmt(G.totalEver);
  document.getElementById('hLevel').textContent=G.level;
  document.getElementById('utitle').textContent=TITLES[Math.min(G.level-1,TITLES.length-1)];

  // Main button icon = active Mara skin art (or icon fallback)
  const maraS=SISTERS.find(x=>x.id==='mara');
  const maraActiveSkin=maraS?.skins.find(sk=>sk.id===(G.sisterSkin.mara||'default'));
  const btnEl=document.getElementById('mainBtn');
  const maraArt=maraS?.img?.[G.sisterSkin.mara||'default'];
  const _btnCur=btnEl.dataset.artSrc||'';
  if(maraArt){
    if(_btnCur!==maraArt){
      btnEl.dataset.artSrc=maraArt;
      btnEl.innerHTML=`<img src="${maraArt}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" alt="" onerror="this.remove();delete this.parentElement.dataset.artSrc;">`;
    }
  } else {
    if(_btnCur){btnEl.dataset.artSrc='';btnEl.textContent='';}
    if(!btnEl.textContent) btnEl.textContent=maraActiveSkin?.icon||'ğŸ­';
  }

  // Combo
  const cv2=document.getElementById('comboVal');
  const cw=document.getElementById('comboWrap');
  const cb=document.getElementById('comboBar');
  cv2.textContent='Ã—'+G.combo.toFixed(1);
  cw.classList.toggle('active',G.combo>1.05);
  cb.style.width=(G.comboTimer/getComboTimeout()*100)+'%';

  // Stats
  const totalGens=Object.values(G.gens).reduce((a,b)=>a+b,0);
  document.getElementById('scClick').textContent=fmt(ec);
  document.getElementById('scGens').textContent=totalGens;
  document.getElementById('scPrestige').textContent='Ã—'+G.prestigeMult.toFixed(1);

  // Prestige bar
  const pct=Math.min(100,(G.totalEver/PRESTIGE_GOAL)*100);
  document.getElementById('pbarFill').style.width=pct+'%';
  document.getElementById('pbarPct').textContent=Math.floor(pct)+'%';
  document.getElementById('prestigeBtn').style.display=G.totalEver>=PRESTIGE_GOAL?'block':'none';

  // Boost chips
  document.getElementById('bFrenzy').classList.toggle('active-boost',!!G.stars['frenzy_active']);
  document.getElementById('bLucky').classList.toggle('active-boost',!!G.stars['lucky_active']);

  checkMS();
  if(now-_lastShopRender>500){_lastShopRender=now;renderShop();}
}

function renderShop(){
  // Stars items
  const sg=document.getElementById('starsGrid');
  if(!sg.children.length){
    STARS_ITEMS.forEach(item=>{
      const el=document.createElement('div');
      el.className='star-card';
      el.innerHTML=`
        ${item.badge?`<div class="sc-badge">${item.badge}</div>`:''}
        <div class="sc-icon">${item.icon}</div>
        <div class="sc-name">${item.name}</div>
        <div class="sc-desc">${item.desc}</div>
        <div class="sc-price">â­ ${item.stars} Stars</div>`;
      el.addEventListener('click',()=>buyStars(item.id));
      sg.appendChild(el);
    });
  }

  // Generators
  const gl=document.getElementById('genList');
  gl.innerHTML='';
  GENS.forEach(gen=>{
    const cost=Math.floor(gen.baseCost*Math.pow(1.15,G.gens[gen.id]||0));
    const owned=G.gens[gen.id]||0;
    const can=G.energy>=cost;
    const gm=genMults[gen.id]||1;
    const realCps=(gen.baseCps*gm*globalMult*G.prestigeMult);
    const el=document.createElement('div');
    el.className='gen-card'+(can?'':' gc-locked');
    el.innerHTML=`
      <div class="gc-icon">${gen.icon}</div>
      <div class="gc-body">
        <div class="gc-name">${gen.name}</div>
        <div class="gc-sub">${gen.desc}</div>
        <div class="gc-cost">${fmt(cost)} ğŸ˜‚</div>
      </div>
      <div>
        <div class="gc-owned">${owned}</div>
        <div class="gc-cps">${fmt(realCps)}/Ñ</div>
      </div>`;
    if(can)el.addEventListener('click',()=>{buyGen(gen.id);renderShop();});
    gl.appendChild(el);
  });

  // Upgrades
  const ul=document.getElementById('upgList');
  ul.innerHTML='';
  UPGRADES.forEach(u=>{
    const bought=!!G.upgs[u.id];
    const can=G.energy>=u.cost;
    const unlocked=G.totalEver>=u.req;
    const el=document.createElement('div');
    el.className='upg-card'+(bought?' uc-maxed':(!can||!unlocked?' uc-locked':''));
    el.innerHTML=`
      <div class="uc-icon">${u.icon}</div>
      <div class="uc-body">
        <div class="uc-name">${u.name}</div>
        <div class="uc-desc">${u.desc}</div>
      </div>
      <div class="uc-right">
        <div class="uc-cost">${bought?'â€”':fmt(u.cost)+' ğŸ˜‚'}</div>
        <div class="uc-status">${bought?'âœ“ Ğ˜Ğ—Ğ£Ğ§Ğ•ĞĞ':(unlocked?'Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞĞ':'Ğ¾Ñ‚ '+fmt(u.req))}</div>
      </div>`;
    if(!bought&&can&&unlocked)el.addEventListener('click',()=>{buyUpg(u.id);});
    ul.appendChild(el);
  });
}

/* â•â• RENDER SISTERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderSisters(){
  const container=document.getElementById('sistersList');
  if(!container)return;
  container.innerHTML='';

  SISTERS.forEach(s=>{
    const unlocked=isSisterUnlocked(s);
    const lv=unlocked?getSisterLevel(s.id):0;
    const xpPct=unlocked?getSisterXpPct(s.id):0;
    const activeSkinId=G.sisterSkin[s.id]||'default';
    const activeSkin=s.skins.find(sk=>sk.id===activeSkinId)||s.skins[0];

    const card=document.createElement('div');
    card.className='sister-card '+(unlocked?'s-unlocked':'s-locked');

    // Portrait
    const hasArt=!!(s.img && s.img[activeSkinId]);
    let portraitInner='';
    if(hasArt){
      portraitInner=`<img src="${s.img[activeSkinId]}" alt="${s.name}" onerror="this.remove()">`;
    }else{
      portraitInner=`<span style="font-size:42px">${activeSkin.icon||s.icon}</span>`;
    }
    if(!unlocked){
      portraitInner+=`<div class="s-portrait-lock">ğŸ”’</div>`;
    }

    // Active bonuses list
    const bonusChips=s.bonuses.map(b=>{
      const active=lv>=b.level;
      return `<div class="s-bonus-chip${active?' active':''}">${active?'âœ“ ':lv<b.level?`Ğ£Ñ€.${b.level}: `:''}${b.desc}</div>`;
    }).join('');

    // Skin thumbnails
    const skinThumbs=s.skins.map(sk=>{
      const skUnlocked=unlocked&&isSkinUnlocked(s,sk);
      const isActive=sk.id===activeSkinId;
      let lockIcon='';
      if(!skUnlocked){
        if(sk.type==='progression') lockIcon=`<div class="s-skin-lock">Ğ£Ñ€${sk.unlockLevel}</div>`;
        else if(sk.type==='stars')  lockIcon=`<div class="s-skin-lock">â­</div>`;
        else if(sk.type==='event')  lockIcon=`<div class="s-skin-lock">ğŸ­</div>`;
      }
      return `<div>
        <div class="s-skin-thumb${isActive?' active':''}${!skUnlocked?' skin-locked':''}"
          data-sid="${s.id}" data-skin="${sk.id}" data-skintype="${sk.type}"
          ${skUnlocked&&!isActive?'style="cursor:pointer"':''}
          title="${!skUnlocked?(sk.type==='stars'?`ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ Ğ·Ğ° ${sk.price} Stars`:sk.type==='progression'?`Ğ£Ñ€. ${sk.unlockLevel} Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°`:'Ğ¡ĞµĞ·Ğ¾Ğ½Ğ½Ñ‹Ğ¹'):'ĞĞ°Ğ´ĞµÑ‚ÑŒ'}">
          ${sk.icon||s.icon}${lockIcon}
        </div>
        <div class="s-skin-name">${sk.name}</div>
      </div>`;
    }).join('');

    // Unlock hint
    let unlockHint='';
    if(!unlocked){
      if(s.unlockCondition.type==='totalEver')
        unlockHint=`<div class="s-unlock-hint">ğŸ”’ ĞÑ‚ĞºÑ€Ğ¾ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ ${fmt(s.unlockCondition.val)} Ğ¡Ğ¼ĞµÑ…Ğ°</div>`;
      else if(s.unlockCondition.type==='prestige')
        unlockHint=`<div class="s-unlock-hint">ğŸ”’ ĞÑ‚ĞºÑ€Ğ¾ĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ ${s.unlockCondition.val} Ğ’Ğ¾ÑÑ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ</div>`;
    }

    card.innerHTML=`
      <div class="s-portrait${hasArt?' has-art':''}">${portraitInner}</div>
      <div class="s-info">
        <div class="s-name">${s.name}</div>
        <div class="s-title">${s.title}</div>
        <div class="s-desc">${s.desc}</div>
        ${unlocked?`
          <div class="s-xp-row">
            <div class="s-xp-label">ĞĞŸĞ«Ğ¢</div>
            <div class="s-xp-track"><div class="s-xp-fill" style="width:${xpPct}%"></div></div>
            <div class="s-level-badge">Ğ£Ñ€. ${lv}</div>
          </div>
          <div class="s-bonuses">${bonusChips}</div>
          <div class="s-skins">${skinThumbs}</div>
        `:`${unlockHint}`}
      </div>`;

    // Portrait click â†’ fullscreen art
    if(hasArt && unlocked){
      card.querySelector('.s-portrait').addEventListener('click',()=>{
        openArtModal(s.img[activeSkinId], s.name+' â€” '+activeSkin.name);
      });
    }

    // Skin click handlers
    if(unlocked){
      // Unlocked skins â€” equip
      card.querySelectorAll('.s-skin-thumb:not(.skin-locked)').forEach(el=>{
        el.addEventListener('click',()=>{
          const sid=el.dataset.sid;
          const skinId=el.dataset.skin;
          if(G.sisterSkin[sid]===skinId)return;
          G.sisterSkin[sid]=skinId;
          save();
          renderSisters();
          const skName=s.skins.find(x=>x.id===skinId)?.name||skinId;
          showToast(`${s.name} â€” Â«${skName}Â» Ğ½Ğ°Ğ´ĞµÑ‚`);
        });
      });
      // Stars skins â€” buy
      card.querySelectorAll('.s-skin-thumb.skin-locked[data-skintype="stars"]').forEach(el=>{
        el.style.cursor='pointer';
        el.addEventListener('click',()=>{
          buyStarsSkin(el.dataset.sid, el.dataset.skin);
        });
      });
    }

    container.appendChild(card);
  });
}

function renderFriends(){
  document.getElementById('friendCount').textContent=G.friends.length;
  const fl=document.getElementById('friendList');
  fl.innerHTML='';
  if(!G.friends.length){
    fl.innerHTML='<div style="text-align:center;color:var(--dim);font-size:12px;padding:24px">ĞŸÑ€Ğ¸Ğ·Ğ¾Ğ²Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ ÑĞ¾ÑĞ·Ğ½Ğ¸ĞºĞ°!</div>';
    return;
  }
  G.friends.forEach(f=>{
    const el=document.createElement('div');el.className='friend-row';
    el.innerHTML=`
      <div class="fr-av">${(f.name[0]||'?').toUpperCase()}</div>
      <div class="fr-info"><div class="fr-name">${f.name}</div><div class="fr-score">${fmt(f.score)} ğŸ˜‚</div></div>
      <div class="fr-earn">+${fmt(f.earned)} Ğ±Ğ¾Ğ½ÑƒÑ</div>`;
    fl.appendChild(el);
  });
}

/* â•â• SHARE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('shareBtn').addEventListener('click',()=>{
  const bot='Cosmiclibot';
  const ref=TGU?.id||'demo';
  const url=`https://t.me/${bot}?start=ref_${ref}`;
  const txt='ğŸ­ Ğ˜Ğ³Ñ€Ğ°Ğ¹ Ğ² Ğ¡ĞĞ¡Ğ¢Ğ Ğ« Ğ¡ĞœĞ•Ğ¥Ğ â€” Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ¸ ĞÑ€Ğ´ĞµĞ½Ñƒ Ğ¿Ğ¾Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒ Ğ¢ĞµĞ½Ğ¸ ĞÑ‚Ñ‡Ğ°ÑĞ½Ğ¸Ñ! ĞĞ±Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ¼ Ğ±Ğ¾Ğ½ÑƒÑ!';
  if(tg?.openTelegramLink){
    tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(txt)}`);
  }else{
    navigator.clipboard?.writeText(url);
    showToast('ğŸ“‹ Ğ¡ÑÑ‹Ğ»ĞºĞ° ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°!');
  }
});

/* â•â• INIT USER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initUser(){
  if(!TGU)return;
  const name=TGU.first_name+(TGU.last_name?' '+TGU.last_name:'');
  document.getElementById('uname').textContent=name;
  const av=document.getElementById('avatar');
  if(TGU.photo_url){av.innerHTML=`<img src="${TGU.photo_url}" alt="">`;}
  else{av.textContent=(name[0]||'?').toUpperCase();}
}

/* â•â• SAVE / LOAD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const KEY='sisters_v1';
function save(){
  try{localStorage.setItem(KEY,JSON.stringify({
    energy:G.energy,totalEver:G.totalEver,clicks:G.clicks,
    prestige:G.prestige,prestigeMult:G.prestigeMult,level:G.level,
    gens:G.gens,upgs:G.upgs,stars:G.stars,
    friends:G.friends,friendBonus:G.friendBonus,
    frenzyExpiresAt:G.frenzyExpiresAt,
    sisterXp:G.sisterXp,sisterSkin:G.sisterSkin,
    savedAt:Date.now(),
  }));}catch(e){}
}
function load(){
  try{
    const raw=localStorage.getItem(KEY);
    if(!raw)return;
    const d=JSON.parse(raw);
    Object.assign(G,d);
    recalc();
    if(G.stars['frenzy_active']){
      const remaining=G.frenzyExpiresAt-Date.now();
      if(remaining<=0){
        delete G.stars['frenzy_active'];
        G.frenzyExpiresAt=0;
      }else{
        setTimeout(()=>{delete G.stars['frenzy_active'];G.frenzyExpiresAt=0;recalc();save();showToast('Ğ¯Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¡Ğ¼ĞµÑ…Ğ° ÑƒĞ³Ğ°ÑĞ»Ğ°...');},remaining);
      }
      recalc();
    }
    if(d.savedAt){
      const elapsed=Math.min((Date.now()-d.savedAt)/1000,offlineCapHours*3600);
      const offlineGain=calcCps()*elapsed;
      if(offlineGain>1){
        G.energy+=offlineGain;
        G.totalEver+=offlineGain;
        setTimeout(()=>showToast('ĞÑ€Ğ´ĞµĞ½ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»: +'+fmt(offlineGain)+' Ğ·Ğ° '+Math.round(elapsed/60)+' Ğ¼Ğ¸Ğ½'),600);
      }
    }
    MS.forEach(m=>{if(G.totalEver>=m.v)_ms.add(m.v);});
  }catch(e){}
}

/* â•â• GAME LOOP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let last=performance.now();

function loop(now){
  const dt=Math.min((now-last)/1000,.5);
  last=now;
  const gain=calcCps()*dt;
  G.energy+=gain;G.totalEver+=gain;
  decayCombo(dt);
  checkLevel();
  // Lily earns XP passively
  gainSisterXp('lily', SISTER_XP_PER_SEC*dt);
  render(now);
  requestAnimationFrame(loop);
}

/* â•â• BOOT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
load();
recalc();
initUser();
renderShop();
renderSisters();
renderFriends();
requestAnimationFrame(ts=>{tg?.ready?.();loop(ts);});
setInterval(save,5000);
window.addEventListener('beforeunload',save);
document.addEventListener('visibilitychange',()=>{if(document.hidden)save();});

/* â•â• ART MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openArtModal(src, name){
  const m=document.getElementById('artModal');
  m.querySelector('img').src=src;
  m.querySelector('.art-name').textContent=name;
  m.classList.add('open');
  tg?.HapticFeedback?.impactOccurred('light');
}
function closeArtModal(){
  document.getElementById('artModal').classList.remove('open');
}
</script>

<!-- ART FULLSCREEN MODAL -->
<div id="artModal" onclick="if(event.target===this||event.target.classList.contains('art-close'))closeArtModal()">
  <div class="art-close">âœ•</div>
  <img src="" alt="">
  <div class="art-name"></div>
</div>
</body>
</html>
